<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Open CASCADE Technology: Upgrade from older OCCT versions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="occ_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Open CASCADE Technology
   &#160;<span id="projectnumber">7.2.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('occt_dev_guides__upgrade.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Upgrade from older OCCT versions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#upgrade_intro">Introduction</a><ul><li class="level2"><a href="#upgrade_intro_precautions">Precautions</a></li>
<li class="level2"><a href="#upgrade_intro_disclaim">Disclaimer</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_65">Upgrade to OCCT 6.5.0</a></li>
<li class="level1"><a href="#upgrade_651">Upgrade to OCCT 6.5.1</a></li>
<li class="level1"><a href="#upgrade_652">Upgrade to OCCT 6.5.2</a></li>
<li class="level1"><a href="#upgrade_653">Upgrade to OCCT 6.5.3</a></li>
<li class="level1"><a href="#upgrade_654">Upgrade to OCCT 6.5.4</a></li>
<li class="level1"><a href="#upgrade_660">Upgrade to OCCT 6.6.0</a></li>
<li class="level1"><a href="#upgrade_670">Upgrade to OCCT 6.7.0</a><ul><li class="level2"><a href="#upgrade_670_clipping">Object-level clipping and capping algorithm.</a></li>
<li class="level2"><a href="#upgrade_670_markers">Redesign of markers presentation</a></li>
<li class="level2"><a href="#upgrade_670_views">Default views are not created automatically</a></li>
<li class="level2"><a href="#upgrade_670_dimensions">Improved dimensions implementation</a></li>
<li class="level2"><a href="#upgrade_670_list_collection">NCollection_Set replaced by List collection</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_680">Upgrade to OCCT 6.8.0</a><ul><li class="level2"><a href="#upgrade_680_ncollection">Changes in NCollection classes</a></li>
<li class="level2"><a href="#upgrade_680_view_camera">3D View Camera</a></li>
<li class="level2"><a href="#upgrade_680_connected_objects">Redesign of Connected Interactive Objects</a></li>
<li class="level2"><a href="#upgrade_680_unicode">Support of UNICODE Characters</a></li>
<li class="level2"><a href="#upgrade_680_projection_shift">Elimination of Projection Shift Concept</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_690">Upgrade to OCCT 6.9.0</a><ul><li class="level2"><a href="#upgrade_690_shaders">3D Viewer initialization</a></li>
<li class="level2"><a href="#upgrade_690_selection">Changes in Selection</a></li>
<li class="level2"><a href="#upgrade_690_adaptor3d-curve">Changes in Adaptor3d_Curve class</a></li>
<li class="level2"><a href="#upgrade_690_v3d_view">Changes in V3d_View class</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_700">Upgrade to OCCT 7.0.0</a><ul><li class="level2"><a href="#upgrade_700_persist">Removal of legacy persistence</a></li>
<li class="level2"><a href="#upgrade_occt700_cdl">Removal of CDL and WOK</a><ul><li class="level3"><a href="#upgrade_occt700_cdl_auto">Automatic upgrade</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_compiler">Possible compiler errors</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_runtime">Possible runtime problems</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_nocast">Option to avoid cast of handle to reference to base type</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_compat">Preserving compatibility with OCCT 6.x</a></li>
<li class="level3"><a href="#upgrade_occt700_cdl_wok">Applications based on CDL and WOK</a></li>
</ul>
</li>
<li class="level2"><a href="#upgrade_occt700_bspline">Separation of BSpline cache</a></li>
<li class="level2"><a href="#upgrade_occt700_booleanresult">Structural result of Boolean operations</a></li>
<li class="level2"><a href="#upgrade_occt700_brepextrema">BRepExtrema_ExtCC finds one solution only</a></li>
<li class="level2"><a href="#upgrade_occt700_sorttools">Removal of SortTools package</a></li>
<li class="level2"><a href="#upgrade_occt700_2dlayers">On-screen objects and ColorScale</a></li>
<li class="level2"><a href="#upgrade_occt700_userdraw">UserDraw and Visual3d</a></li>
<li class="level2"><a href="#upgrade_occt700_localcontext">Deprecation of Local Context</a></li>
<li class="level2"><a href="#upgrade_occt700_separate_caf_visualisation">Separation of visualization part from TKCAF</a></li>
<li class="level2"><a href="#upgrade_euler_angles">Correction of interpretation of Euler angles in gp_Quaternion</a></li>
<li class="level2"><a href="#upgrade_zoom_persistent_selection">Zoom Persistent Selection</a></li>
<li class="level2"><a href="#upgrade_occt700_correction_of_texture">Texture mapping of objects</a></li>
<li class="level2"><a href="#upgrade_occt700_wfshape">Shape presentation builders</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt710">Upgrade to OCCT 7.1.0</a><ul><li class="level2"><a href="#upgrade_710_aspects">Presentation attributes</a></li>
<li class="level2"><a href="#upgrade_710_types">Typedefs</a></li>
<li class="level2"><a href="#upgrade_710_ffp">Programmable Pipeline</a></li>
<li class="level2"><a href="#upgrade_710_trsfpers">Transformation persistence</a></li>
<li class="level2"><a href="#upgrade_710_selprops">Dynamic highlight and selection properties</a></li>
<li class="level2"><a href="#upgrade_occt710_correction_of_TObj_Model">Correction in TObj_Model class</a></li>
<li class="level2"><a href="#upgrade_710_env">Redundant environment variables</a></li>
<li class="level2"><a href="#upgrade_710_removed">Removed features</a></li>
<li class="level2"><a href="#upgrade_710_changed_methods">Other changes</a></li>
</ul>
</li>
<li class="level1"><a href="#upgrade_occt720">Upgrade to OCCT 7.2.0</a><ul><li class="level2"><a href="#upgrade_720_removed">Removed features</a></li>
<li class="level2"><a href="#upgrade_occt720_reshape_oriented_removed">Corrections in BRepOffset API</a></li>
<li class="level2"><a href="#upgrade_occt720_correction_of_Offset_API">Corrections in BRepOffset API</a></li>
<li class="level2"><a href="#upgrade_720_highlight">Highlight style</a></li>
<li class="level2"><a href="#upgrade_720_implicit_viewer_update">Elimination of implicit 3D Viewer updates</a></li>
<li class="level2"><a href="#upgrade_720_v3d_colorname">Elimination of Quantity_NameOfColor from TKV3d interface classes</a></li>
<li class="level2"><a href="#upgrade_720_Result_Of_BOP_On_Containers">Result of Boolean operations on containers</a></li>
<li class="level2"><a href="#upgrade_720_changes_methods">Other changes</a></li>
<li class="level2"><a href="#upgrade_720_BOP_DataStructure">BOP - Pairs of interfering indices</a></li>
<li class="level2"><a href="#upgrade_720_Removal_Of_Old_Boolean_Operations_Draw">Removal of the Draw commands based on old Boolean operations</a></li>
<li class="level2"><a href="#upgrade_720_Change_Of_FaceFace_Intersection">Change of Face/Face intersection in Boolean operations</a></li>
<li class="level2"><a href="#upgrade_720_persistence">Restore OCCT 6.9.1 persistence</a></li>
<li class="level2"><a href="#upgrade_720_Change_In_BRepLib_MakeFace_Algo">Change in BRepLib_MakeFace algorithm</a></li>
<li class="level2"><a href="#upgrade_720_Change_In_BRepFill_OffsetWire">Change in BRepFill_OffsetWire algorithm</a></li>
<li class="level2"><a href="#upgrade_720_Change_In_GeomAdaptor_Curve">Change in Geom(2d)Adaptor_Curve::IsPeriodic</a></li>
<li class="level2"><a href="#upgrade_720_UnifySameDomain">Change in algorithm ShapeUpgrade_UnifySameDomain</a></li>
<li class="level2"><a href="#upgrade_720_Change_In_RWStl">Changes in STL Reader / Writer</a></li>
<li class="level2"><a href="#upgrade_720_New_Error_Warning_system_in_BOA">Refactoring of the Error/Warning reporting system in Boolean Component</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="upgrade_intro"></a>
Introduction</h1>
<p>This document provides technical details on changes made in particular versions of OCCT. It can help to upgrade user applications based on previous versions of OCCT to newer ones.</p>
<h2><a class="anchor" id="upgrade_intro_precautions"></a>
Precautions</h2>
<p>Back-up your code before the upgrade. We strongly recommend using version control system during the upgrade process and saving one or several commits at each step of upgrade, until the overall result is verified. This will facilitate identification and correction of possible problems that can occur at the intermediate steps of upgrade. It is advisable to document each step carefully to be able to repeat it if necessary.</p>
<h2><a class="anchor" id="upgrade_intro_disclaim"></a>
Disclaimer</h2>
<p>This document describes known issues that have been encountered during porting of OCCT and some applications and approaches that have helped to resolve these issues in known cases. It does not pretend to cover all possible migration issues that can appear in your application. Take this document with discretion; apply your expertise and knowledge of your application to ensure the correct result.</p>
<p>The automatic upgrade tool is provided as is, without warranty of any kind, and we explicitly disclaim any liability for possible errors that may appear due to use of this tool. It is your responsibility to ensure that the changes you made in your code are correct. When you upgrade the code by an automatic script, make sure to carefully review the introduced changes at each step before committing them.</p>
<h1><a class="anchor" id="upgrade_65"></a>
Upgrade to OCCT 6.5.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5 requires taking into account the following major changes:</p><ul>
<li>If you are not comfortable with dependence on Intel TBB, FreeImage, or Gl2Ps libraries, you will need to (re)build OCCT with these dependencies disabled.</li>
<li>The low-level format version of OCAF binary and XML persistence has been incremented. Hence, the files saved by OCCT 6.5 to OCAF binary or XML format will not be readable by previous versions of OCCT.</li>
<li>The <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_rep_mesh.html">BRepMesh</a></em> triangulation algorithm has been seriously revised and now tries hard to fulfill the requested deflection and angular tolerance parameters. If you experience any problems with performance or triangulation quality (in particular, display of shapes in shading mode), consider revising the values of these parameters used in your application.</li>
<li>If you were using method <em>ToPixMap()</em> of class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> to get a buffer for passing to Windows API functions (e.g. <em>BitBlt</em>), this will not work anymore. You will need to use method <em>Image_PixMap::AccessBuffer()</em> to get the raw buffer data that can be further passed to WinAPI functions.</li>
<li>As the processing of message gravity parameter in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_message.html">Message</a></em> package has been improved, some application messages (especially the ones generated by IGES or STEP translators) can be suppressed or new messages appear in the application. Use relevant message level parameter to tune this behavior.</li>
</ul>
<h1><a class="anchor" id="upgrade_651"></a>
Upgrade to OCCT 6.5.1</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.1 requires taking into account the following major changes:</p>
<ul>
<li>Method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure.html#aade33875d00bcdce0a873c74ad90d952">Graphic3d_Structure::Groups()</a></em> now returns <em>Graphic3d_SequenceOfGroup</em>. If this method has been used, the application code should be updated to iterate another collection type or, if <em>Graphic3d_HSetOfGroup</em> is required, to fill its own collection: <div class="fragment"><div class="line">const Graphic3d_SequenceOfGroup&amp; aGroupsSeq = theStructure.Groups();</div><div class="line">Handle(Graphic3d_HSetOfGroup) aGroupSet = new Graphic3d_HSetOfGroup();</div><div class="line">Standard_Integer aLen = aGroupsSeq.Length();</div><div class="line">for (Standard_Integer aGr = 1; aGr &lt;= aLen; ++aGr)</div><div class="line">{</div><div class="line"> aGroupSet-&gt;Add (aGroupsSeq.Value (aGr));</div><div class="line">}</div></div><!-- fragment --></li>
<li>All occurrences of <em>Select3D_Projector</em> in the application code (if any) should be replaced with <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle(Select3D_Projector)</a></em>.</li>
<li>The code of inheritors of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select3_d___sensitive_entity.html">Select3D_SensitiveEntity</a></em> should be updated if they override <em>Matches()</em> (this is probable, if clipping planes are used).</li>
<li>Constructor for <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___plane.html">V3d_Plane</a></em> has been changed, so the extra argument should be removed if used in the application. It is necessary to add a new plane using method <em>V3d_Viewer::AddPlane()</em> if <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html">V3d_Viewer</a></em> has been used to manage clipping planes list (this does not affect clipping planes representation). Please, have a look at the source code for new DRAWEXE <em>vclipplane</em> command in <em>ViewerTest_ObjectsCommands.cxx, VClipPlane</em> to see how clipping planes can be managed in the application.</li>
</ul>
<h1><a class="anchor" id="upgrade_652"></a>
Upgrade to OCCT 6.5.2</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.2 requires taking into account the following major changes:</p><ul>
<li>Any code that has been generated by WOK from CDL generic classes <em>Tcollection_DataMap</em> and <em>Tcollection_IndexedDataMap</em> needs to be regenerated by WOK to take into account the change in the interface of these classes.</li>
<li>The enumerations <em>CDF_StoreStatus</em> and <em>CDF_RetrievableStatus</em> have been replaced by the enumerations <em>PCDM_StoreStatus</em> and <em>PCDM_ReaderStatus</em>. Correspondingly, the methods <em>Open, Save</em> and <em>SaveAs</em> of the class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_doc_std___application.html">TDocStd_Application</a></em> have changed their return value. Any code, which uses these enumerations, needs to be updated.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_lib___make_face.html">BRepLib_MakeFace</a></em> has been modified to receive tolerance value for resolution of degenerated edges. This tolerance parameter has no default value to ensure that the client code takes care of passing a meaningful value, not just <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_precision.html#a94f8d5777a3e8e1c61bd7bbfa8dfc0eb">Precision::Confusion</a></em>, so some porting overheads are expected.</li>
<li>If the callback mechanism in call_togl_redraw function was used in the application code, it is necessary to revise it to take into account the new callback execution and provide a check of reason value of Aspect_GraphicCallbackStruct in callback methods to confirm that the callback code is executed at the right moment. Now the callbacks are executed before redrawing the underlayer, before redrawing the overlayer and at the end of redrawing. The information about the moment when the callback is invoked is provided with the reason value in form of an additional bit flag <em>(OCC_PRE_REDRAW, OCC_PRE_OVERLAY)</em>. The state of <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_open_gl.html">OpenGl</a> changed in callback methods will not be restored automatically, which might lead to unwanted behavior in redrawing procedure.</li>
<li>The print method used in the application code might need to be revised to take into account the ability to choose between print algorithms: tile and stretch. The stretch algorithm will be selected by default during porting.</li>
<li>It is recommended to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___discret_factory.html">BRepMesh_DiscretFactory</a></em> users, to check <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___discret_factory.html#aef8bba4de9eb3a365f95acd6cdb57a52">BRepMesh_DiscretFactory::SetDefault()</a></em> return value to determine plugin availability / validity. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___discret_factory.html#aab1481c2e5e960979d629bcd1cdf4271">BRepMesh_DiscretFactory::Discret()</a></em> method now returns handle instead of pointer. The code should be updated in the following manner: <div class="fragment"><div class="line">Handle(BRepMesh_DiscretRoot) aMeshAlgo = BRepMesh_DiscretFactory::Get().Discret (theShape, theDeflection, theAngularToler);</div><div class="line"> if (!aMeshAlgo.IsNull())  {}</div></div><!-- fragment --></li>
<li>The default state of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_rep_mesh.html">BRepMesh</a></em> parallelization has been turned off. The user should switch this flag explicitly:<ul>
<li>by using methods <em>BRepMesh_IncrementalMesh::SetParallel(Standard_True)</em> for each <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___incremental_mesh.html">BRepMesh_IncrementalMesh</a></em> instance before <em>Perform()</em>;</li>
<li>by calling <em>BRepMesh_IncrementalMesh::SetParallelDefault(Standard_True)</em> when <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_mesh___discret_factory.html">BRepMesh_DiscretFactory</a></em> is used to retrieve the meshing tool (this also affects auto-triangulation in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s.html">AIS</a></em>).</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="upgrade_653"></a>
Upgrade to OCCT 6.5.3</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.3 requires taking into account the following major changes:</p><ul>
<li>As a result of code clean-up and redesign of <em>TKOpenGl</em> driver, some obsolete functions and rendering primitives <em>(TriangleMesh, TriangleSet, Bezier, Polyline, Polygon, PolygonHoles, QuadrangleMesh</em> and <em>QuadrangleSet</em>) have been removed. Instead, the application developers should use primitive arrays that provide the same functionality but are hardware-accelerated. The details can be found in OCCT Visualization User's Guide, “Primitive Arrays” chapter.</li>
<li>Applications should not call <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html#aede01b8961416a8997587b5fc550048a">AIS_InteractiveObject::SetPolygonOffsets()</a></em> method for an instance of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___textured_shape.html">AIS_TexturedShape</a></em> class after it has been added to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a></em>. More generally, modification of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___aspect_fill_area3d.html">Graphic3d_AspectFillArea3d</a></em> parameters for the computed groups of any <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em> subclass that uses texture mapping should be avoided, because this results in broken texture mapping (see issue 23118). It is still possible to apply non-default polygon offsets to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___textured_shape.html">AIS_TexturedShape</a></em> by calling <em>SetPolygonOffsets()</em> before displaying the shape.</li>
<li>The applications that might have used internal functions provided by <em>TKOpenGl</em> or removed primitives will need to be updated.</li>
<li>In connection with the implementation of Z-layers it might be necessary to revise the application code or revise the custom direct descendant classes of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___graphic_driver.html">Graphic3d_GraphicDriver</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure_manager.html">Graphic3d_StructureManager</a></em> to use the Z-layer feature.</li>
<li>Global variables <em>Standard_PI</em> and <em>PI</em> have been eliminated (use macro <em>M_PI</em> instead).</li>
<li>Method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_vrml_data___node_8hxx.html#aa161f34d6f7c3678dfdf3fd30dcab1ee">HashCode()</a></em> has been removed from class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___transient.html">Standard_Transient</a></em>. It is advisable to use global function <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_vrml_data___node_8hxx.html#aa161f34d6f7c3678dfdf3fd30dcab1ee">HashCode()</a></em> for Handle objects instead.</li>
<li>Declaration of operators new/delete for classes has become consistent and is encapsulated in macros.</li>
<li>Memory management has been changed to use standard heap <em>(MMGT_OPT=0)</em> and reentrant mode <em>(MMGT_REENTRANT=1)</em> by default.</li>
<li>Map classes in <em>NCollection</em> package now receive one more argument defining a hash tool.</li>
</ul>
<h1><a class="anchor" id="upgrade_654"></a>
Upgrade to OCCT 6.5.4</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.5.4 requires taking into account the following major changes:</p><ul>
<li>The code using obsolete classes <em>Aspect_PixMap, Xw_PixMap</em> and <em>WNT_PixMap</em> should be rewritten implementing class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html">Image_PixMap</a></em>, which is now retrieved by <em>ToPixMap</em> methods as argument. A sample code using <em>ToPixMap</em> is given below: <div class="fragment"><div class="line">#include &lt;Image_AlienPixMap.hxx&gt;</div><div class="line">void dump (Handle(V3d_View)&amp; theView3D)</div><div class="line">{</div><div class="line">  Standard_Integer aWndSizeX = 0;</div><div class="line">  Standard_Integer aWndSizeY = 0;</div><div class="line">  theView3D-&gt;Window()-&gt;Size (aWndSizeX, aWndSizeY);</div><div class="line">  Image_AlienPixMap aPixMap;</div><div class="line">  theView3D-&gt;ToPixMap (aPixMap, aWndSizeX, aWndSizeY);</div><div class="line">  aPixMap.Save (&quot;c:\\image.png&quot;);</div><div class="line">}</div></div><!-- fragment --></li>
<li>Now OpenGL resources related to Interactive Objects are automatically freed when the last view (window) is removed from graphical driver. To avoid presentation data loss, the application should replace an old view with a new one in the proper order: first the new view is created and activated and only then the old one is detached and removed.</li>
<li>It is recommended to use <em>NCollection</em> containers with hasher parameter (introduced in 6.5.3) instead of global definition <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_vrml_data___node_8hxx.html#a7aa25b13306dbce70d3b6b186e9ab585">IsEqual()</a>/HashCode()</em> as well as to use explicit namespaces to avoid name collision.</li>
</ul>
<h1><a class="anchor" id="upgrade_660"></a>
Upgrade to OCCT 6.6.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.6.0 requires taking into account the following major changes:</p><ul>
<li>Due to the changes in the implementation of Boolean Operations, the order of sub-shapes resulting from the same operation performed with OCCT 6.5.x and OCCT 6.6.0 can be different. It is necessary to introduce the corresponding changes in the applications for which the order of sub-shapes resulting from a Boolean operation is important. It is strongly recommended to use identification methods not relying on the order of sub-shapes (e.g. OCAF naming).</li>
<li>If you need to use OCCT on Mac OS X with X11 (without Cocoa), build OCCT with defined pre-processor macro <em>CSF_MAC_USE_GLX11</em>. XLib front-end (previously the only way for unofficial OCCT builds on Mac OS X) is now disabled by default on this platform. If your application has no support for Cocoa framework you may build OCCT with XLib front-end adding <em>MACOSX_USE_GLX</em> macro to compiler options (you may check the appropriate option in WOK configuration GUI and in CMake configuration). Notice that XQuartz (XLib implementation for Mac OS X) now is an optional component and does not provide a sufficient level of integrity with native (Cocoa-based) applications in the system. It is not possible to build OCCT with both XLib and Cocoa at the same time due to symbols conflict in OpenGL functions.</li>
<li>Animation mode and degeneration presentation mode (simplified presentation for animation) and associated methods have been removed from 3D viewer functionality. Correspondingly, the code using methods <em>SetAnimationModeOn(), SetAnimationModeOff(), AnimationModeIsOn(), AnimationMode(), Tumble(), SetDegenerateModeOn(), SetDegenerateModeOff()</em> and <em>DegenerateModeIsOn()</em> of classes <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> and <em>Visual3d_View</em> will need to be removed or redesigned. Please, notice that Hidden Line Removal presentation was not affected; however, the old code that used methods <em>V3d_View::SetDegenerateModeOn</em> or <em>V3d_View::SetDegenerateModeOff</em> to control HLR presentation should be updated to use <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#aa08a43ab1863e1fd5b27108fad63f341">V3d_View::SetComputedMode</a></em> method instead.</li>
<li>Calls of <em>Graphic3d_Group::BeginPrimitives()</em> and <em>Graphic3d_Group::EndPrimitives()</em> should be removed from the application code.</li>
<li>Application functionality for drawing 2D graphics that was formerly based on <em>TKV2d</em> API should be migrated to <em>TKV3d</em> API. The following changes are recommended for this migration:<ul>
<li>A 2D view can be implemented as a <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> instance belonging to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html">V3d_Viewer</a></em> managed by <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a></em> instance. To turn <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> into a 2D view, the necessary view orientation should be set up at the view initialization stage using <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a10319dcdbc4f89796a4dddf698e2fdd6">V3d_View::SetProj()</a></em> method, and view rotation methods simply should not be called.</li>
<li>Any 2D graphic entity (formerly represented with <em>AIS2D_InteractiveObject</em>) should become a class derived from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em> base. These entities should be manipulated in a view using <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a></em> class API.</li>
<li>All drawing code should be put into <em>Compute()</em> virtual method of a custom interactive object class and use API of <em>Graphic3d</em> package. In particular, all geometry should be drawn using class hierarchy derived from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___array_of_primitives.html">Graphic3d_ArrayOfPrimitives</a></em>. Normally, the Z coordinate for 2D geometry should be constant, unless the application implements some advanced 2D drawing techniques like e.g. multiple "Z layers" of drawings.</li>
<li>Interactive selection of 2D presentations should be set up inside <em>ComputeSelection()</em> virtual method of a custom interactive object class, using standard sensitive entities from <em>Select3D</em> package and standard or custom entity owners derived from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___entity_owner.html">SelectMgr_EntityOwner</a></em> base. Please refer to the Visualization User's Guide for further details concerning OCCT 3D visualization and selection classes. See also <em>Viewer2D</em> OCCT sample application, which shows how 2D drawing can be implemented using TKV3d API.</li>
</ul>
</li>
<li>Run-time graphic driver library loading mechanism based on <em>CSF_GraphicShr</em> environment variable usage has been replaced by explicit linking against <em>TKOpenGl</em> library. The code sample below shows how the graphic driver should be created and initialized in the application code: <div class="fragment"><div class="line">// initialize a new viewer with OpenGl graphic driver</div><div class="line">Handle(Graphic3d_GraphicDriver) aGraphicDriver = </div><div class="line">new OpenGl_GraphicDriver (&quot;TKOpenGl&quot;);</div><div class="line">  aGraphicDriver-&gt;Begin (new Aspect_DisplayConnection());</div><div class="line">  TCollection_ExtendedString aNameOfViewer (&quot;Visu3D&quot;);</div><div class="line">  Handle(V3d_Viewer) aViewer </div><div class="line">= new V3d_Viewer (aGraphicDriver, aNameOfViewer.ToExtString());</div><div class="line">  aViewer-&gt;Init();</div><div class="line"></div><div class="line">// create a new window or a wrapper over the existing window, </div><div class="line">// provided by a 3rd-party framework (Qt, MFC, C# or Cocoa)</div><div class="line">#if defined(_WIN32) || defined(__WIN32__)</div><div class="line">  Aspect_Handle aWindowHandle = (Aspect_Handle )winId();</div><div class="line">  Handle(WNT_Window) aWindow = new WNT_Window (winId());</div><div class="line">#elif defined(__APPLE__) &amp;&amp; !defined(MACOSX_USE_GLX)</div><div class="line">  NSView* aViewHandle = (NSView* )winId();</div><div class="line">  Handle(Cocoa_Window) aWindow = new Cocoa_Window (aViewHandle);</div><div class="line">#else</div><div class="line"> Aspect_Handle aWindowHandle = (Aspect_Handle )winId();</div><div class="line">  Handle(Xw_Window) aWindow = </div><div class="line">     new Xw_Window (aGraphicDriver-&gt;GetDisplayConnection(), aWindowHandle);</div><div class="line">#endif // WNT</div><div class="line"></div><div class="line">// setup the window for a new view</div><div class="line">  Handle(V3d_View) aView = aViewer-&gt;CreateView();</div><div class="line">  aView-&gt;SetWindow (aWindow);</div></div><!-- fragment --></li>
<li>The following changes should be made in the application-specific implementations of texture aspect:<ul>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___texture_root.html">Graphic3d_TextureRoot</a></em> inheritors now should return texture image by overloading of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___texture_root.html#a27a68a899fb22170f05844f897b42336">Graphic3d_TextureRoot::GetImage()</a></em> method instead of the old logic.</li>
<li>Now you can decide if the application should store the image copy as a field of property or reload it dynamically each time (to optimize the memory usage). The default implementation (which loads the image content from the provided file path) does not hold an extra copy since it will be uploaded to the graphic memory when first used.</li>
<li>Notice that the image itself should be created within <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html">Image_PixMap</a></em> class from <em>AlienImage</em> package, while <em>Image_Image</em> class is no more supported and will be removed in the next OCCT release.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="upgrade_670"></a>
Upgrade to OCCT 6.7.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.7.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_670_clipping"></a>
Object-level clipping and capping algorithm.</h2>
<ul>
<li>It might be necessary to revise and port code related to management of view-level clipping to use <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___clip_plane.html">Graphic3d_ClipPlane</a></em> instead of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___plane.html">V3d_Plane</a></em> instances. Please note that <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___plane.html">V3d_Plane</a></em> class has been preserved &ndash; as previously, it can be used as plane representation. Another approach to represent <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___clip_plane.html">Graphic3d_ClipPlane</a></em> in a view is to use custom presentable object.</li>
<li>The list of arguments of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select3_d___sensitive_entity.html#a0a772ed0a6c442ffb35f410c156b1477">Select3D_SensitiveEntity::Matches()</a></em> method for picking detection has changed. Since now, for correct selection clipping, the implementations should perform a depth clipping check and return (as output argument) minimum depth value found at the detected part of sensitive. Please refer to CDL / Doxygen documentation to find descriptive hints and snippets.</li>
<li><em>Select3D_SensitiveEntity::ComputeDepth()</em> abstract method has been removed. Custom implementations should provide depth checks by method <em>Matches()</em> instead &ndash; all data required for it is available within a scope of single method.</li>
<li>It might be necessary to revise the code of custom sensitive entities and port <em>Matches()</em> and <em>ComputeDepth()</em> methods to ensure proper selection clipping. Please note that obsolete signature of <em>Matches</em> is not used anymore by the selector. If your class inheriting <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select3_d___sensitive_entity.html">Select3D_SensitiveEntity</a></em> redefines the method with old signature the code should not compile as the return type has been changed. This is done to prevent override of removed methods.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_markers"></a>
Redesign of markers presentation</h2>
<ul>
<li>Due to the redesign of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___aspect_marker3d.html">Graphic3d_AspectMarker3d</a></em> class the code of custom markers initialization should be updated. Notice that you can reuse old markers definition code as <em>TColStd_HArray1OfByte</em>; however, <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html">Image_PixMap</a></em> is now the preferred way (and supports full-color images on modern hardware).</li>
<li>Logics and arguments of methods <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#aff5b73947ef64850ca7f81197d9fad94">AIS_InteractiveContext::Erase()</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#aeee3c605903c5e1c6db51b9cff09b4c4">AIS_InteractiveContext::EraseAll()</a></em> have been changed. Now these methods do not remove resources from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure.html">Graphic3d_Structure</a></em>; they simply change the visibility flag in it. Therefore, the code that deletes and reсomputes resources should be revised.</li>
<li><em>Graphic3d_Group::MarkerSet()</em> has been removed. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___group.html#a008b00a842d93d8d987734389bd9b91b">Graphic3d_Group::AddPrimitiveArray()</a></em> should be used instead to specify marker(s) array.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_views"></a>
Default views are not created automatically</h2>
<p>As the obsolete methods <em>Init(), DefaultOrthographicView()</em> and <em>DefaultPerspectiveView()</em> have been removed from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html">V3d_Viewer</a></em> class, the two default views are no longer created automatically. It is obligatory to create <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> instances explicitly, either directly by operator new or by calling <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html#ab1c7d60aba29f1fd91195e668d6aaeba">V3d_Viewer::CreateView()</a></em>.</p>
<p>The call <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html#a6f326234b8d42732a8489e9291ede675">V3d_Viewer::SetDefaultLights()</a></em> should also be done explicitly at the application level, if the application prefers to use the default light source configuration. Otherwise, the application itself should set up the light sources to obtain a correct 3D scene.</p>
<h2><a class="anchor" id="upgrade_670_dimensions"></a>
Improved dimensions implementation</h2>
<ul>
<li>It might be necessary to revise and port code related to management of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___length_dimension.html">AIS_LengthDimension</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___angle_dimension.html">AIS_AngleDimension</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___diameter_dimension.html">AIS_DiameterDimension</a></em> presentations. There is no more need to compute value of dimension and pass it as string to constructor argument. The value is computed internally. The custom value can be set with <em>SetCustomValue()</em> method.</li>
<li>The definition of units and general aspect properties is now provided by <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs3d___dimension_units.html">Prs3d_DimensionUnits</a></em> and <em>Prs3d_DimensionApsect</em> classes.</li>
<li>It might be also necessary to revise code of your application related to usage of <em>AIS_DimensionDisplayMode enumeration</em>. If it used for specifying the selection mode, then it should be replaced by a more appropriate enumeration <em>AIS_DimensionSelectionMode</em>.</li>
</ul>
<h2><a class="anchor" id="upgrade_670_list_collection"></a>
NCollection_Set replaced by List collection</h2>
<p>It might be necessary to revise your application code, which uses non-ordered <em>Graphic3d_SetOfHClipPlane</em> collection type and replace its occurrences by ordered <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___sequence_of_h_clip_plane.html">Graphic3d_SequenceOfHClipPlane</a></em> collection type.</p>
<h1><a class="anchor" id="upgrade_680"></a>
Upgrade to OCCT 6.8.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.8.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_680_ncollection"></a>
Changes in NCollection classes</h2>
<p>Method <em>Assign()</em> in <em>NCollection</em> classes does not allow any more copying between different collection types. Such copying should be done manually.</p>
<p>List and map classes in <em>NCollection</em> package now require that their items be copy-constructible, but do not require items to have default constructor. Thus the code using <em>NCollection</em> classes for non-copy-constructible objects needs be updated. One option is to provide copy constructor; another possibility is to use Handle or other smart pointer.</p>
<h2><a class="anchor" id="upgrade_680_view_camera"></a>
3D View Camera</h2>
<p>If <em>ViewMapping</em> and <em>ViewOrientation</em> were used directly, this functionality has to be ported to the new camera model. The following methods should be considered as an alternative to the obsolete <em>Visual3d</em> services (all points and directions are supposed to be in world coordinates):</p><ul>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#aa592c93d818efe31922166ff37861f75">Graphic3d_Camera::ViewDimensions()</a></em> or <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#ad6da5917d04d938941c0226f8881223a">V3d_View::Size()</a>/ZSize()</em> &ndash; returns view width, height and depth (or "Z size"). Since the view is symmetric now, you can easily compute top, bottom, left and right limits. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#a71550c1000e27129ae4accc276235406">Graphic3d_Camera::ZNear()</a>/ZFar()</em> can be used to obtain the near and far clipping distances with respect to the eye.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#af8e19b2b419e410e05fe46d6a059d86c">Graphic3d_Camera::Up()</a></em> or <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a493bf6b7fd9f67fce4084b820be77d9c">V3d_View::Up()</a></em> &ndash; returns Y direction of the view.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#aff4e3c055cf1fea725011996622d7c94">Graphic3d_Camera::Direction()</a></em> returns the reverse view normal directed from the eye, <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a5aa3f148773dc7e8fa47b15b7df9d9f5">V3d_View::Proj()</a></em> returns the old-style view normal.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#ada5e3753a33ee85aa2c0ca5e92116f77">Graphic3d_Camera::Eye()</a></em> or <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a68916788ae9e483dd660b63522939b18">V3d_View::Eye()</a></em> &ndash; returns the camera position (same as projection reference point in old implementation).</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#aa264a65772098c1c9062875ed954b397">Graphic3d_Camera::Center()</a></em> or <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#aeeef47b32663afbe4e26890b51110a40">V3d_View::At()</a></em> &ndash; returns the point the camera looks at (or view reference point according to old terminology).</li>
</ul>
<p>The current perspective model is not fully backward compatible, so the old perspective-related functionality needs to be reviewed.</p>
<p>Please revise application-specific custom presentations to provide proper bounding box. Otherwise object might become erroneously clipped by automatic <em>ZFit</em> or frustum culling algorithms enabled by default.</p>
<h2><a class="anchor" id="upgrade_680_connected_objects"></a>
Redesign of Connected Interactive Objects</h2>
<p>The new implementation of connected Interactive Objects makes it necessary to take the following steps if you use connected Interactive Objects in your application.</p><ul>
<li>Use new <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html">PrsMgr_PresentableObject</a></em> transformation API.</li>
<li>Call <em>RemoveChild()</em> from the original object after connect if you need the original object and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___connected_interactive.html">AIS_ConnectedInteractive</a></em> to move independently.</li>
<li>Access instances of objects connected to <em>AIS_MultiplyConnectedInteractive</em> with <em>Children()</em> method.</li>
<li>For <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html">PrsMgr_PresentableObject</a></em> transformation:<ul>
<li><em>SetLocation (<a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_top_loc___location.html">TopLoc_Location</a>) -&gt; SetLocalTransformation (<a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___trsf.html">gp_Trsf</a>)</em></li>
<li><em>Location -&gt; LocalTransformation</em></li>
<li><em>HasLocation -&gt; HasTransformation</em></li>
<li><em>ResetLocation -&gt; ResetTransformation</em></li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="upgrade_680_unicode"></a>
Support of UNICODE Characters</h2>
<p>Support of UNICODE characters introduced in OCCT breaks backward compatibility with applications, which currently use filenames in extended ASCII encoding bound to the current locale. Such applications should be updated to convert such strings to UTF-8 format.</p>
<p>The conversion from UTF-8 to wchar_t is made using little-endian approach. Thus, this code will not work correctly on big-endian platforms. It is needed to complete this in the way similar as it is done for binary persistence (see the macro <em>DO_INVERSE</em> in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_f_s_d___file_header_8hxx.html">FSD_FileHeader.hxx</a>).</em></p>
<h2><a class="anchor" id="upgrade_680_projection_shift"></a>
Elimination of Projection Shift Concept</h2>
<p>It might be necessary to revise the application code, which deals with <em>Center()</em> method of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em>.</p>
<p>This method was used to pan a <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d.html">V3d</a></em> view by virtually moving the screen center with respect to the projection ray passed through Eye and At points. There is no more need to derive the panning from the Center parameter to get a camera-like eye position and look at the coordinates. <em>Eye()</em> and <em>At()</em> now return these coordinates directly. When porting code dealing with <em>Center()</em>, the parameters <em>Eye()</em> and <em>At()</em> can be adjusted instead. Also <em>V3d_View::SetCenter(Xpix, Ypix)</em> method can be used instead of <em>V3d_View::Center(X, Y)</em> to center the view at the given point. However, if the center coordinates X and Y come from older OCCT releases, calling <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a14d0af3990ffb97d9f6a5a8ab53be1bd">V3d_View::Panning</a>(-X, -Y)</em> can be recommended to compensate missing projection shift effect.</p>
<p>There are several changes introduced to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html">Graphic3d_Camera</a></em>. The internal data structure of the camera is based on <em>Standard_Real</em> data types to avoid redundant application-level conversions and precision errors. The transformation matrices now can be evaluated both for <em>Standard_Real</em> and <em>Standard_ShortReal</em> value types. <em>ZNear</em> and <em>ZFar</em> planes can be either negative or positive for orthographic camera projection, providing a trade-off between the camera distance and the range of <em>ZNear</em> or <em>ZFar</em> to reduce difference of exponents of values composing the orientation matrix - to avoid calculation errors. The negative values can be specified to avoid Z-clipping if the reference system of camera goes inside of the model when decreasing camera distance.</p>
<p>The auto z fit mode, since now, has a parameter defining Z-range margin (the one which is usually passed as argument to <em>ZFitAll()</em> method). The methods <em>SetAutoZFitMode(), AutoZFitScaleFactor()</em> and <em>ZFitAll()</em> from class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> deal with the new parameter.</p>
<p>The class <em>Select3D_Projector</em> now supports both orientation and projection transformation matrices, which can be naturally set for the projector. The definition of projector was revised in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_std_select___viewer_selector3d.html">StdSelect_ViewerSelector3d</a></em>: perspective and orthographic projection parameters are handled properly. Orthographic projector is based only on direction of projection - no more <em>Center</em> property. This makes it possible to avoid unnecessary re-projection of sensitive while panning, zooming or moving along the projection ray of the view. These operations do not affect the orthographic projection.</p>
<h1><a class="anchor" id="upgrade_690"></a>
Upgrade to OCCT 6.9.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 6.9.0 requires taking into account the following major changes.</p>
<h2><a class="anchor" id="upgrade_690_shaders"></a>
3D Viewer initialization</h2>
<p>3D Viewer now uses GLSL programs for managing frame buffer and stereoscopic output. For proper initialization, application should configure <b>CSF_ShadersDirectory</b> environment variable pointing to a folder with GLSL resources - files from folder <b>CASROOT</b>/src/Shaders. <em>Note that <b>CSF_ShadersDirectory</b> become optional since OCCT 7.1.0 release</em>.</p>
<h2><a class="anchor" id="upgrade_690_selection"></a>
Changes in Selection</h2>
<p>Selection mechanism of 3D Viewer has been redesigned to use 3-level <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> tree traverse directly in 3D space instead of projection onto 2D screen space (updated on each rotation). This architectural redesign may require appropriate changes at application level in case if custom Interactive Objects are used.</p>
<h4><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard.html">Standard</a> selection</h4>
<p>Usage of standard OCCT selection entities would require only minor updates.</p>
<p>Custom Interactive Objects should implement new virtual method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___selectable_object.html#afd701c1f91cb47d157347d59de13382b">SelectMgr_SelectableObject::BoundingBox()</a>.</em></p>
<p>Now the method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___selection.html#a7e8b6eb3919b05b6ccd6aae160d20834">SelectMgr_Selection::Sensitive()</a></em> does not return <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___sensitive_entity.html">SelectBasics_SensitiveEntity</a></em>. It returns an instance of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___sensitive_entity.html">SelectMgr_SensitiveEntity</a></em>, which belongs to a different class hierarchy (thus <em>DownCast()</em> will fail). To access base sensitive it is necessary to use method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___sensitive_entity.html#abff9521b8100bcc8472b1195d3f6f69c">SelectMgr_SensitiveEntity::BaseSensitive()</a></em>. For example:</p>
<div class="fragment"><div class="line">Handle(SelectMgr_Selection) aSelection = anInteractiveObject-&gt;Selection (aMode);</div><div class="line">for (aSelection-&gt;Init(); aSelection-&gt;More(); aSelection-&gt;Next())</div><div class="line">{</div><div class="line">   Handle(SelectBasics_SensitiveEntity) anEntity = aSelection-&gt;Sensitive()-&gt;BaseSensitive();</div><div class="line">}</div></div><!-- fragment --><h4>Custom sensitive entities</h4>
<p>Custom sensitive entities require more complex changes, since the selection algorithm has been redesigned and requires different output from the entities.</p>
<p>The method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___sensitive_entity.html#a7e4b98d5501f1cbf7994c7cee1fef40f">SelectBasics_SensitiveEntity::Matches()</a></em> of the base class should be overridden following the new signature:</p>
<p><em>Standard_Boolean Matches (<a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___selecting_volume_manager.html">SelectBasics_SelectingVolumeManager</a>&amp; theMgr, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/struct_select_basics___pick_result.html">SelectBasics_PickResult</a>&amp; thePickResult)</em>, where <em>theMgr</em> contains information about the currently selected frustum or set of frustums (see <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___rectangular_frustum.html">SelectMgr_RectangularFrustum</a>, SelectMgr_TrangularFrustum, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___triangular_frustum_set.html">SelectMgr_TriangularFrustumSet</a>)</em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/struct_select_basics___pick_result.html">SelectBasics_PickResult</a></em> is an output parameter, containing information about the depth of the detected entity and distance to its center of geometry.</p>
<p>In the overridden method it is necessary to implement an algorithm of overlap and inclusion detection (the active mode is returned by <em>theMgr.IsOverlapAllowed()</em>) with triangular and rectangular frustums.</p>
<p>The depth and distance to the center of geometry must be calculated for the 3D projection of user-picked screen point in the world space. You may use already implemented overlap and inclusion detection methods for different primitives from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___rectangular_frustum.html">SelectMgr_RectangularFrustum</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___triangular_frustum.html">SelectMgr_TriangularFrustum</a></em>, including triangle, point, axis-aligned box, line segment and planar polygon.</p>
<p>Here is an example of overlap/inclusion test for a box:</p>
<div class="fragment"><div class="line">if (!theMgr.IsOverlapAllowed()) // check for inclusion</div><div class="line">{</div><div class="line">  Standard_Boolean isInside = Standard_True;</div><div class="line">  return theMgr.Overlaps (myBox.CornerMin(), myBox.CornerMax(), &amp;isInside) &amp;&amp; isInside;</div><div class="line">}</div><div class="line"></div><div class="line">Standard_Real aDepth;</div><div class="line">if (!theMgr.Overlaps (myBox, aDepth)) // check for overlap</div><div class="line">{</div><div class="line">  return Standard_False;</div><div class="line">}</div><div class="line"></div><div class="line">thePickResult =</div><div class="line">SelectBasics_PickResult (aDepth, theMgr.DistToGeometryCenter (myCenter3d));</div></div><!-- fragment --><p>The interface of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___sensitive_entity.html">SelectBasics_SensitiveEntity</a></em> now contains four new pure virtual functions that should be implemented by each custom sensitive:</p><ul>
<li><em>BoundingBox()</em> – returns a bounding box of the entity;</li>
<li><em>Clear()</em> – clears up all the resources and memory allocated for complex sensitive entities;</li>
<li><em>BVH()</em> – builds a <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> tree for complex sensitive entities, if it is needed;</li>
<li><em>NbSubElements()</em> – returns atomic sub-entities of a complex sensitive entity, which will be used as primitives for <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> building. If the entity is simple and no <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> is required, this method returns 1.</li>
</ul>
<p>Each sensitive entity now has its own tolerance, which can be overridden by method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_basics___sensitive_entity.html#aac7bf7a49787f5a55851a830542b968d">SelectBasics_SensitiveEntity::SetSensitivityFactor()</a></em> called from constructor.</p>
<h2><a class="anchor" id="upgrade_690_adaptor3d-curve"></a>
Changes in Adaptor3d_Curve class</h2>
<p>All classes inheriting <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_adaptor3d___curve.html">Adaptor3d_Curve</a></em> (directly or indirectly) must be updated in application code to use new signature of methods <em>Intervals()</em> and <em>NbIntervals()</em>. Note that no compiler warning will be generated if this is not done.</p>
<h2><a class="anchor" id="upgrade_690_v3d_view"></a>
Changes in V3d_View class</h2>
<p>The methods <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a9f0abb65a86d59b3816745a4bbe24744">V3d_View::Convert</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a5a3fad1d24ccb15eb3b3c836093d89a3">V3d_View::ConvertWithProj()</a></em> have ceased to return point on the active grid. It might be necessary to revise the code of your application so that <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a1b724e8713aec8c57e100a6310d2e969">V3d_View::ConvertToGrid()</a></em> was called explicitly for the values returned by <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a9f0abb65a86d59b3816745a4bbe24744">V3d_View::Convert</a></em> to get analogous coordinates on the grid. The methods <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a9f0abb65a86d59b3816745a4bbe24744">V3d_View::Convert</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a5a3fad1d24ccb15eb3b3c836093d89a3">V3d_View::ConvertWithProj</a></em> convert point into reference plane of the view corresponding to the intersection with the projection plane of the eye/view point vector.</p>
<h1><a class="anchor" id="upgrade_700"></a>
Upgrade to OCCT 7.0.0</h1>
<p>Porting of user applications from an earlier OCCT version to version 7.0.0 requires taking into account the following major changes.</p>
<p>Building OCCT now requires compiler supporting some C++11 features. The supported compilers are:</p><ul>
<li>MSVC: version 10 (Visual Studio 2010) or later</li>
<li>GCC: version 4.3 or later</li>
<li>CLang: version 3.6 or later</li>
<li>ICC: version XE 2013 SP 1 or later</li>
</ul>
<p>When compiling code that uses OCCT with GCC and CLang compilers, it is necessary to use compiler option -std=c++0x (or its siblings) to enable C++11 features.</p>
<h2><a class="anchor" id="upgrade_700_persist"></a>
Removal of legacy persistence</h2>
<p>Legacy persistence for shapes and OCAF data based on <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_storage___schema.html">Storage_Schema</a></em> (toolkits <em>TKPShape</em>, <em>TKPLCAF</em>, <em>TKPCAF</em>, <em>TKShapeShcema, TLStdLSchema, TKStdSchema</em>, and <em>TKXCAFSchema</em>) has been removed in OCCT 7.0.0. The applications that used these data persistence tools need to be updated to use other persistence mechanisms.</p>
<dl class="section note"><dt>Note</dt><dd>For compatibility with previous versions, the possibility to read standard OCAF data (<em>TKLCAF</em> and <em>TKCAF</em>) from files stored in the old format is preserved (toolkits <em>TKStdL</em> and <em>TKStd</em>).</dd></dl>
<p>The existing data files in standard formats can be converted using OCCT 6.9.1 or a previous version, as follows.</p>
<dl class="section note"><dt>Note</dt><dd>Reading / writing custom files capability from OCCT 6.9.1 is restored in OCCT 7.2.0. See details in <a class="el" href="occt_dev_guides__upgrade.html#upgrade_720_persistence">Restore OCCT 6.9.1 persistence</a> section.</dd></dl>
<h4>CSFDB files</h4>
<p>Files in <em>CSFDB</em> format (usually with extension .csfdb) contain OCCT shape data that can be converted to BRep format. The easiest way to do that is to use ImportExport sample provided with OCCT 6.9.0 (or earlier):</p>
<ul>
<li>Start ImportExport sample;</li>
<li>Select File / New;</li>
<li>Select File / Import / CSFDB... and specify the file to be converted;</li>
<li>Drag the mouse with the right button pressed across the view to select all shapes by the rectangle;</li>
<li>Select File / Export / BREP... and specify the location and name for the resulting file</li>
</ul>
<h4>OCAF and XCAF documents</h4>
<p>Files containing OCAF data saved in the old format usually have extensions <em>.std, .sgd</em> or <em>.dxc</em> (XDE documents). These files can be converted to XML or binary OCAF formats using DRAW Test Harness commands. Note that if the file contains only attributes defined in <em>TKLCAF</em> and <em>TKCAF</em>, this action can be performed in OCCT 7.0; otherwise OCCT 6.9.1 or earlier should be used.</p>
<p>For that, start <em>DRAWEXE</em> and perform the following commands:</p>
<ul>
<li>To convert <em>*.std</em> and <em>*.sgd</em> file formats to binary format <em>*.cbf</em> (The created document should be in <em>BinOcaf</em> format instead of <em>MDTV-Standard</em>):</li>
</ul>
<div class="fragment"><div class="line">Draw[]&gt; pload ALL</div><div class="line">Draw[]&gt; Open [path to *.std or *.sgd file] Doc</div><div class="line">Draw[]&gt; Format Doc BinOcaf</div><div class="line">Draw[]&gt; SaveAs Doc [path to the new file]</div></div><!-- fragment --><ul>
<li>To convert <em>*.dxc</em> file format to binary format <em>*.xbf</em> (The created document should be in <em>BinXCAF</em> format instead of <em>MDTV-XCAF</em>):</li>
</ul>
<div class="fragment"><div class="line">Draw[]&gt; pload ALL</div><div class="line">Draw[]&gt; XOpen [path to *.dxc file] Doc</div><div class="line">Draw[]&gt; Format Doc BinXCAF</div><div class="line">Draw[]&gt; XSave Doc [path to the new file]</div></div><!-- fragment --><p>On Windows, it is necessary to replace back slashes in the file path by direct slashes or pairs of back slashes.</p>
<p>Use <em>XmlOcaf</em> or <em>XmlXCAF</em> instead of <em>BinOcaf</em> and <em>BinXCAF</em>, respectively, to save in XML format instead of binary one.</p>
<h2><a class="anchor" id="upgrade_occt700_cdl"></a>
Removal of CDL and WOK</h2>
<p>OCCT code has been completely refactored in version 7.0 to get rid of obsolete technologies used since its inception: CDL (Cas.Cade Definition Language) and WOK (Workshop Organization Kit).</p>
<p>C++ code previously generated by WOK from CDL declarations is now included directly in OCCT sources.</p>
<p>This modification did not change names, API, and behavior of existing OCCT classes, thus in general the code based on OCCT 6.x should compile and work fine with OCCT 7.0. However, due to redesign of basic mechanisms (CDL generic classes, Handles and RTTI) using C++ templates, some changes may be necessary in the code when porting to OCCT 7.0, as described below.</p>
<p>WOK is not necessary anymore for building OCCT from sources, though it still can be used in a traditional way &ndash; auxiliary files required for that are preserved. The recommended method for building OCCT 7.x is CMake, see <a class="el" href="occt_dev_guides__building_cmake.html">Building with CMake</a>. The alternative solution is to use project files generated by OCCT legacy tool <b>genproj</b>, see <a class="el" href="occt_dev_guides__building_msvc.html">Building with MS Visual C++</a>, <a class="el" href="occt_dev_guides__building_code_blocks.html">Building with Code::Blocks</a>, and <a class="el" href="occt_dev_guides__building_xcode.html">Building with Xcode</a>.</p>
<h3><a class="anchor" id="upgrade_occt700_cdl_auto"></a>
Automatic upgrade</h3>
<p>Most of typical changes required for upgrading code for OCCT 7.0 can be done automatically using the <em>upgrade</em> tool included in OCCT 7.0. This tool is a Tcl script, thus Tcl should be available on your workstation to run it.</p>
<p>Example: </p><div class="fragment"><div class="line">$ tclsh</div><div class="line">% source &lt;path_to_occt&gt;/adm/upgrade.tcl</div><div class="line">% upgrade -recurse -all -src=&lt;path_to_your_sources&gt;</div></div><!-- fragment --><p>On Windows, the helper batch script <em>upgrade.bat</em> can be used, provided that Tcl is either available in <em>PATH</em>, or configured via <em>custom.bat</em> script (for instance, if you use OCCT installed from Windows installer package). Start it from the command prompt:</p>
<div class="fragment"><div class="line">cmd&gt; &lt;path_to_occt&gt;\upgrade.bat -recurse -all -inc=&lt;path_to_occt&gt;\inc -src=&lt;path_to_your_sources&gt; [options]</div></div><!-- fragment --><p>Run the upgrade tool without arguments to see the list of available options.</p>
<p>The upgrade tool performs the following changes in the code.</p>
<ol type="1">
<li><p class="startli">Replaces macro <em>DEFINE_STANDARD_RTTI</em> by <em>DEFINE_STANDARD_RTTIEXT</em>, with second argument indicating base class for the main argument class (if inheritance is recognized by the script): </p><div class="fragment"><div class="line">DEFINE_STANDARD_RTTI(Class) -&gt; DEFINE_STANDARD_RTTIEXT(Class, Base)</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>If macro <em>DEFINE_STANDARD_RTTI</em> with two arguments (used in intermediate development versions of OCCT 7.0) is found, the script will convert it to either <em>DEFINE_STANDARD_RTTIEXT</em> or <em>DEFINE_STANDARD_RTTI_INLINE</em>. The former case is used if current file is header and source file with the same name is found in the same folder. In this case, macro <em>IMPLEMENT_STANDARD_RTTI</em> is injected in the corresponding source file. The latter variant defines all methods for RTTI as inline, and does not require <em>IMPLEMENT_STANDARD_RTTIEXT</em> macro.</dd></dl>
</li>
<li>Replaces forward declarations of collection classes previously generated from CDL generics (defined in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection.html">TCollection</a></em> package) by inclusion of the corresponding header: <div class="fragment"><div class="line">class TColStd_Array1OfReal; -&gt; #include &lt;TColStd_Array1OfReal.hxx&gt;</div></div><!-- fragment --></li>
<li>Replaces underscored names of <em>Handle</em> classes by usage of a macro: <div class="fragment"><div class="line">Handle_Class -&gt; Handle(Class)</div></div><!-- fragment --> This change is not applied if the source or header file is recognized as containing the definition of Qt class with signals or slots, to avoid possible compilation errors of MOC files caused by inability of MOC to recognize macros (see <a href="http://doc.qt.io/qt-4.8/signalsandslots.html">http://doc.qt.io/qt-4.8/signalsandslots.html</a>). The file is considered as defining a Qt object if it contains strings <em>Q_OBJECT</em> and either <em>slots:</em> or <em>signals:</em>.</li>
<li>Removes forward declarations of classes with names <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle(C)</a></em> or <em>Handle_C</em>, replacing them either by forward declaration of its argument class, or (for files defining Qt objects) <em>#include</em> statement for a header with the name of the argument class and extension .hxx: <div class="fragment"><div class="line">class Handle(TColStd_HArray1OfReal); -&gt; #include &lt;TColStd_HArray1OfReal.hxx&gt;</div></div><!-- fragment --></li>
<li>Removes <em> #includes </em> of files <em>Handle_...hxx</em> that have disappeared in OCCT 7.0: <div class="fragment"><div class="line">#include &lt;Handle_Geom_Curve.hxx&gt; -&gt;</div></div><!-- fragment --></li>
<li>Removes <em>typedef</em> statements that use <em>Handle</em> macro to generate the name: <div class="fragment"><div class="line">typedef NCollection_Handle&lt;Message_Msg&gt; Handle(Message_Msg); -&gt;</div></div><!-- fragment --></li>
<li>Converts C-style casts applied to Handles into calls to <em>DownCast()</em> method: <div class="fragment"><div class="line">((Handle(A)&amp;)b)     -&gt; Handle(A)::DownCast(b)</div><div class="line">(Handle(A)&amp;)b       -&gt; Handle(A)::DownCast(b)</div><div class="line">(*((Handle(A)*)&amp;b)) -&gt; Handle(A)::DownCast(b)</div><div class="line">*((Handle(A)*)&amp;b)   -&gt; Handle(A)::DownCast(b)</div><div class="line">(*(Handle(A)*)&amp;b)   -&gt; Handle(A)::DownCast(b)</div></div><!-- fragment --></li>
<li>Moves <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle()</a></em> macro out of namespace scope: <div class="fragment"><div class="line">Namespace::Handle(Class) -&gt; Handle(Namespace::Class)</div></div><!-- fragment --></li>
<li>Converts local variables of reference type, which are initialized by a temporary object returned by call to <em>DownCast()</em>, to the variables of non-reference type (to avoid using references to destroyed memory): <div class="fragment"><div class="line">const Handle(A)&amp; a = Handle(B)::DownCast (b); -&gt; Handle(A) a (Handle(B)::DownCast (b));</div></div><!-- fragment --></li>
<li>Adds <em>#include</em> for all classes used as argument to macro <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_8hxx.html#aea8b57a4fa80060017fe460aab588ed8">STANDARD_TYPE()</a></em>, except for already included ones;</li>
<li><p class="startli">Removes uses of obsolete macros <em>IMPLEMENT_DOWNCAST</em> and <em>IMPLEMENT_STANDARD_</em>..., except <em>IMPLEMENT_STANDARD_RTTIEXT</em>.</p>
<dl class="section note"><dt>Note</dt><dd>If you plan to keep compatibility of your code with older versions of OCCT, add option <em>-compat</em> to avoid this change. See also <a class="el" href="occt_dev_guides__upgrade.html#upgrade_occt700_cdl_compat">Preserving compatibility with OCCT 6.x</a>.</dd></dl>
</li>
</ol>
<p>As long as the upgrade routine runs, some information messages are sent to the standard output. In some cases the warnings or errors like the following may appear:</p>
<div class="fragment"><div class="line">Error in {HEADER_FILE}: Macro DEFINE_STANDARD_RTTI used for class {CLASS_NAME} whose declaration is not found in this file, cannot fix</div></div><!-- fragment --><p>Be sure to check carefully all reported errors and warnings, as the corresponding code will likely require manual corrections. In some cases these messages may help you to detect errors in your code, for instance, cases where <em>DEFINE_STANDARD_RTTI</em> macro is used with incorrect class name as an argument.</p>
<h3><a class="anchor" id="upgrade_occt700_cdl_compiler"></a>
Possible compiler errors</h3>
<p>Some situations requiring upgrade cannot be detected and / or handled by the automatic procedure. If you get compiler errors or warnings when trying to build the upgraded code, you will need to fix them manually. The following paragraphs list known situations of this kind.</p>
<h4>Missing header files</h4>
<p>The use of handle objects (construction, comparison using operators == or !=, use of function <em>STANDRAD_TYPE()</em> and method <em>DownCast()</em>) now requires the type of the object pointed by Handle to be completely known at compile time. Thus it may be necessary to include header of the corresponding class to make the code compilable.</p>
<p>For example, the following lines will fail to compile if <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_geom___line_8hxx.html">Geom_Line.hxx</a></em> is not included:</p>
<div class="fragment"><div class="line">Handle(Geom_Line) aLine = 0;</div><div class="line">if (aLine != aCurve) {...} </div><div class="line">if (aCurve-&gt;IsKind(STANDARD_TYPE(Geom_Line)) {...}</div><div class="line">aLine = Handle(Geom_Line)::DownCast (aCurve);</div></div><!-- fragment --><p>Note that it is not necessary to include header of the class to declare Handle to it. However, if you define a class <em>B</em> that uses Handle(<em>A</em>) in its fields, or contains a method returning Handle(<em>A</em>), it is advisable to have header defining <em>A</em> included in the header of <em>B</em>. This will eliminate the need to include the header <em>A</em> in each source file where class <em>B</em> is used.</p>
<h4>Ambiguity of calls to overloaded functions</h4>
<p>This issue appears in the compilers that do not support default arguments in template functions (known cases are Visual C++ 10 and 11): the compiler reports an ambiguity error if a handle is used in the argument of a call to the function that has two or more overloaded versions, receiving handles to different types. The problem is that operator <em> const handle&lt;T2&gt;&amp; </em> is defined for any type <em>T2</em>, thus the compiler cannot make the right choice.</p>
<p>Example: </p><div class="fragment"><div class="line">void func (const Handle(Geom_Curve)&amp;);</div><div class="line">void func (const Handle(Geom_Surface)&amp;);</div><div class="line"></div><div class="line">Handle(Geom_TrimmedCurve) aCurve = new Geom_TrimmedCurve (...);</div><div class="line">func (aCurve); // ambiguity error in VC++ 10</div></div><!-- fragment --><p>Note that this problem can be avoided in many cases if macro <em>OCCT_HANDLE_NOCAST</em> is used, see <a class="el" href="occt_dev_guides__upgrade.html#upgrade_occt700_cdl_nocast">below</a>.</p>
<p>To resolve this ambiguity, change your code so that argument type should correspond exactly to the function signature. In some cases this can be done by using the relevant type for the corresponding variable, like in the example above:</p>
<div class="fragment"><div class="line">Handle(Geom_Curve) aCurve = new Geom_TrimmedCurve (...);  </div></div><!-- fragment --><p>Other variants consist in assigning the argument to a local variable of the correct type and using the direct cast or constructor:</p>
<div class="fragment"><div class="line">const Handle(Geom_Curve)&amp; aGCurve (aTrimmedCurve);</div><div class="line">func (aGCurve); // OK - argument has exact type</div><div class="line">func (static_cast(aCurve)); // OK - direct cast </div><div class="line">func (Handle(Geom_Curve)(aCurve)); // OK - temporary handle is constructed</div></div><!-- fragment --><p>Another possibility consists in defining additional template variant of the overloaded function causing ambiguity, and using <em>SFINAE</em> to resolve the ambiguity. This technique can be illustrated by the definition of the template variant of method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_i_g_e_s_data___i_g_e_s_writer.html#a21fe887f63362a15e8344d3b6c2e1f28">IGESData_IGESWriter::Send()</a></em>.</p>
<h4>Lack of implicit cast to base type</h4>
<p>As the cast of a handle to the reference to another handle to the base type has become a user-defined operation, the conversions that require this cast together with another user-defined cast will not be resolved automatically by the compiler.</p>
<p>For example:</p>
<div class="fragment"><div class="line">Handle(Geom_Geometry) aC = GC_MakeLine (p, v); // compiler error</div></div><!-- fragment --><p>The problem is that the class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_g_c___make_line.html">GC_MakeLine</a></em> has a user-defined conversion to <em>const <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle(Geom_TrimmedCurve)</a>&amp;,</em> which is not the same as the type of the local variable <em>aC</em>.</p>
<p>To resolve this, use method <em>Value()</em>:</p>
<div class="fragment"><div class="line">Handle(Geom_Geometry) aC = GC_MakeLine (p, v).Value(); // ok</div></div><!-- fragment --><p>or use variable of the appropriate type:</p>
<div class="fragment"><div class="line">Handle(Geom_TrimmedCurve) aC = GC_MakeLine (p, v); // ok</div></div><!-- fragment --><p>A similar problem appears with GCC compiler, when <em>const</em> handle to derived type is used to construct handle to base type via assignment (and in some cases in return statement), for instance:</p>
<div class="fragment"><div class="line">const Handle(Geom_Line) aLine;</div><div class="line">Handle(Geom_Curve) c1 = aLine; // GCC error </div><div class="line">Handle(Geom_Curve) c2 (aLine); // ok</div></div><!-- fragment --><p>This problem is specific to GCC and it does not appear if macro <em>OCCT_HANDLE_NOCAST</em> is used, see <a class="el" href="occt_dev_guides__upgrade.html#upgrade_occt700_cdl_nocast">below</a>.</p>
<h4>Incorrect use of STANDARD_TYPE and Handle macros</h4>
<p>You might need to clean your code from incorrect use of macros <em>STANDARD_TYPE</em>() and <em>Handle</em>().</p>
<ol type="1">
<li><p class="startli">Explicit definitions of static functions with names generated by macro <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_8hxx.html#aea8b57a4fa80060017fe460aab588ed8">STANDARD_TYPE()</a></em>, which are artifacts of old implementation of RTTI, should be removed.</p>
<p class="startli">Example: </p><div class="fragment"><div class="line">const Handle(Standard_Type)&amp; STANDARD_TYPE(math_GlobOptMin)</div><div class="line">{</div><div class="line">  static Handle(Standard_Type) _atype = new Standard_Type (&quot;math_GlobOptMin&quot;, sizeof (math_GlobOptMin));</div><div class="line">  return _atype;</div><div class="line">}</div></div><!-- fragment --></li>
<li><p class="startli">Incorrect location of closing parenthesis of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle()</a></em> macro that was not detectable in OCCT 6.x will cause a compiler error and must be corrected.</p>
<p class="startli">Example (note misplaced closing parenthesis): </p><div class="fragment"><div class="line">aBSpline = Handle( Geom2d_BSplineCurve::DownCast(BS-&gt;Copy()) );</div></div><!-- fragment --></li>
</ol>
<h4>Use of class Standard_AncestorIterator</h4>
<p>Class <em>Standard_AncestorIterator</em> has been removed; use method <em>Parent()</em> of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___type.html">Standard_Type</a></em> class to parse the inheritance chain.</p>
<h4>Absence of cast to Standard_Transient*</h4>
<p>Handles in OCCT 7.0 do not have the operator of conversion to <em>Standard_Transient*,</em> which was present in earlier versions. This is done to prevent possible unintended errors like this:</p>
<div class="fragment"><div class="line">Handle(Geom_Line) aLine = ...;</div><div class="line">Handle(Geom_Surface) aSurf = ...;</div><div class="line">...</div><div class="line">if (aLine == aSurf) {...} // will cause a compiler error in OCCT 7.0, but not OCCT 6.x</div></div><!-- fragment --><p>The places where this implicit cast has been used should be corrected manually. The typical situation is when Handle is passed to stream:</p>
<div class="fragment"><div class="line">Handle(Geom_Line) aLine = ...;</div><div class="line">os &lt;&lt; aLine; // in OCCT 6.9.0, resolves to operator &lt;&lt; (void*) </div></div><!-- fragment --><p>Call method <em>get()</em> explicitly to output the address of the Handle.</p>
<h4>Method DownCast for non-base types</h4>
<p>Method <em>DownCast()</em> in OCCT 7.0 is made templated; if its argument is not a base class, "deprecated" compiler warning is generated. This is done to prevent possible unintended errors like this:</p>
<div class="fragment"><div class="line">Handle(Geom_Surface) aSurf = ;</div><div class="line">Handle(Geom_Line) aLine = </div><div class="line">  Handle(Geom_Line)::DownCast (aSurf); // will cause a compiler warning in OCCT 7.0, but not OCCT 6.x</div></div><!-- fragment --><p>The places where this cast has been used should be corrected manually.</p>
<p>If down casting is used in a template context where the argument can have the same or unrelated type so that <em>DownCast()</em> may be not available in all cases, use C++ <em>dynamic_cast&lt;&gt;</em> instead, e.g.:</p>
<div class="fragment"><div class="line">template &lt;class T&gt;</div><div class="line">bool CheckLine (const Handle(T) theArg)</div><div class="line">{</div><div class="line">  Handle(Geom_Line) aLine = dynamic_cast&lt;Geom_Line&gt; (theArg.get());</div><div class="line">  ...</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_runtime"></a>
Possible runtime problems</h3>
<p>Here is the list of known possible problems at run time after the upgrade to OCCT 7.0.</p>
<h4>References to temporary objects</h4>
<p>In previous versions, the compiler was able to detect the situation when a local variable of a "reference to a Handle" type is initialized by temporary object, and ensured that lifetime of that object is longer than that of the variable. In OCCT 7.0 with default options, it will not work if types of the temporary object and variable are different (due to involvement of user-defined type cast), thus such temporary object will be destroyed immediately.</p>
<p>This problem does not appear if macro <em>OCCT_HANDLE_NOCAST</em> is used during compilation, see below.</p>
<p>Example:</p>
<div class="fragment"><div class="line">// note that DownCast() returns new temporary object!</div><div class="line">const Handle(Geom_BoundedCurve)&amp; aBC =</div><div class="line">Handle(Geom_TrimmedCurve)::DownCast(aCurve);</div><div class="line">aBC-&gt;Transform (T); // access violation in OCCT 7.0</div></div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_nocast"></a>
Option to avoid cast of handle to reference to base type</h3>
<p>In OCCT 6.x and earlier versions the handle classes formed a hierarchy echoing the hierarchy of the corresponding object classes . This automatically enabled the possibility to use the handle to a derived class in all contexts where the handle to a base class was needed, e.g. to pass it in a function by reference without copying:</p>
<div class="fragment"><div class="line">Standard_Boolean GetCurve (Handle(Geom_Curve)&amp; theCurve);</div><div class="line">....</div><div class="line">Handle(Geom_Line) aLine;</div><div class="line">if (GetCurve (aLine)) {</div><div class="line">  // use aLine, unsafe</div><div class="line">}</div></div><!-- fragment --><p>This feature was used in multiple places in OCCT and dependent projects. However it is potentially unsafe: in the above example no checks are done at compile time or at run time to ensure that the type assigned to the argument handle is compatible with the type of the handle passed as argument. If an object of incompatible type (e.g. <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom___circle.html">Geom_Circle</a>) is assigned to <em>theCurve</em>, the behavior will be unpredictable.</p>
<p>For compatibility with the existing code, OCCT 7.0 keeps this possibility by default, providing operators of type cast to the handle to a base type. However, this feature is unsafe and in specific situations it may cause compile-time or run-time errors as described above.</p>
<p>To provide a safer behavior, this feature can be disabled by a compile-time macro <em>OCCT_HANDLE_NOCAST</em>. When it is used, constructors and assignment operators are defined (instead of type cast operators) to convert handles to a derived type into handles to a base type. This implies creation of temporary objects and hence may be more expensive at run time in some circumstances, however this way is more standard, safer, and in general recommended.</p>
<p>The code that relies on the possibility of casting to base should be amended to always use the handle of argument type in function call and to use <em>DownCast()</em> to safely convert the result to the desired type. For instance, the code from the example below can be changed as follows:</p>
<div class="fragment"><div class="line">Handle(Geom_Line) aLine;</div><div class="line">Handle(Geom_Curve) aCurve;</div><div class="line">if (GetCurve (aCure) &amp;&amp; !(aLine = Handle(Geom_Line)::DownCast (aCurve)).IsNull()) {</div><div class="line">  // use aLine safely</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="upgrade_occt700_cdl_compat"></a>
Preserving compatibility with OCCT 6.x</h3>
<p>If you like to preserve the compatibility of your application code with OCCT versions 6.x even after the upgrade to 7.0, consider the following suggestions:</p>
<ol type="1">
<li>If your code used sequences of macros <em>IMPLEMENT_STANDARD_</em>... generated by WOK, replace them by single macro <em>IMPLEMENT_STANDARD_RTTIEXT</em></li>
<li>When running automatic upgrade tool, add option <em>-compat</em>.</li>
<li><p class="startli">Define macros <em>DEFINE_STANDARD_RTTIEXT</em> and <em>DEFINE_STANDARD_RTTI_INLINE</em> when building with previous versions of OCCT, resolving to <em>DEFINE_STANDARD_RTTI</em> with single argument</p>
<p class="startli">Example: </p><div class="fragment"><div class="line">#if OCC_VERSION_HEX &lt; 0x070000</div><div class="line">  #define DEFINE_STANDARD_RTTIEXT(C1,C2) DEFINE_STANDARD_RTTI(C1)</div><div class="line">  #define DEFINE_STANDARD_RTTI_INLINE(C1,C2) DEFINE_STANDARD_RTTI(C1)</div><div class="line">#endif</div></div><!-- fragment --></li>
</ol>
<h3><a class="anchor" id="upgrade_occt700_cdl_wok"></a>
Applications based on CDL and WOK</h3>
<p>If your application is essentially based on CDL, and you need to upgrade it to OCCT 7.0, you will very likely need to convert your application code to non-CDL form. This is a non-trivial effort; the required actions would depend strongly on the structure of the code and used CDL features.</p>
<p>The upgrade script and sources of a specialized WOK version used for OCCT code upgrade can be found in WOK Git repository in branch <a href="http://git.dev.opencascade.org/gitweb/?p=occt-wok.git;a=log;h=refs/heads/CR0_700_2">CR0_700_2</a>.</p>
<p><a href="http://www.opencascade.com/contact/">Contact us</a> if you need more help.</p>
<h2><a class="anchor" id="upgrade_occt700_bspline"></a>
Separation of BSpline cache</h2>
<p>Implementation of NURBS curves and surfaces has been revised: the cache of polynomial coefficients, which is used to accelerate the calculation of values of a B-spline, has been separated from data objects <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom2d___b_spline_curve.html">Geom2d_BSplineCurve</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom___b_spline_curve.html">Geom_BSplineCurve</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom___b_spline_surface.html">Geom_BSplineSurface</a></em> into the dedicated classes <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_spl_c_lib___cache.html">BSplCLib_Cache</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_spl_s_lib___cache.html">BSplSLib_Cache</a></em>.</p>
<p>The benefits of this change are:</p><ul>
<li>Reduced memory footprint of OCCT shapes (up to 20% on some cases)</li>
<li>Possibility to evaluate the same B-Spline concurrently in parallel threads without data races and mutex locks</li>
</ul>
<p>The drawback is that direct evaluation of B-Splines using methods of curves and surfaces becomes slower due to the absence of cache. The slow-down can be avoided by using adaptor classes <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom2d_adaptor___curve.html">Geom2dAdaptor_Curve</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom_adaptor___curve.html">GeomAdaptor_Curve</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom_adaptor___surface.html">GeomAdaptor_Surface</a></em>, which now use cache when the curve or surface is a B-spline.</p>
<p>OCCT algorithms have been changed to use adaptors for B-spline calculations instead of direct methods for curves and surfaces. The same changes (use of adaptors instead of direct call to curve and surface methods) should be implemented in relevant places in the applications based on OCCT to get the maximum performance.</p>
<h2><a class="anchor" id="upgrade_occt700_booleanresult"></a>
Structural result of Boolean operations</h2>
<p>The result of Boolean operations became structured according to the structure of the input shapes. Therefore it may impact old applications that always iterate on direct children of the result compound assuming to obtain solids as iteration items, regardless of the structure of the input shapes. In order to get always solids as iteration items it is recommended to use <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_top_exp___explorer.html">TopExp_Explorer</a> instead of <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_topo_d_s___iterator.html">TopoDS_Iterator</a>.</p>
<h2><a class="anchor" id="upgrade_occt700_brepextrema"></a>
BRepExtrema_ExtCC finds one solution only</h2>
<p>Extrema computation between non-analytical curves in shape-shape distance calculation algorithm has been changed in order to return only one solution. So, if e.g. two edges are created on parallel b-spline curves the algorithm <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_extrema___dist_shape_shape.html">BRepExtrema_DistShapeShape</a> will return only one solution instead of enormous number of solutions. There is no way to get algorithm working in old manner.</p>
<h2><a class="anchor" id="upgrade_occt700_sorttools"></a>
Removal of SortTools package</h2>
<p>Package <em>SortTools</em> has been removed. The code that used the tools provided by that package should be corrected manually. The recommended approach is to use sorting algorithms provided by STL.</p>
<p>For instance: </p><div class="fragment"><div class="line">#include &lt;SortTools_StraightInsertionSortOfReal.hxx&gt;</div><div class="line">#include &lt;SortTools_ShellSortOfReal.hxx&gt;</div><div class="line">#include &lt;TCollection_CompareOfReal.hxx&gt;</div><div class="line">...</div><div class="line">TCollection_Array1OfReal aValues = ...;</div><div class="line">...</div><div class="line">TCollection_CompareOfReal aCompReal;</div><div class="line">SortTools_StraightInsertionSortOfReal::Sort(aValues, aCompReal);</div></div><!-- fragment --><p> can be replaced by: </p><div class="fragment"><div class="line">#include &lt;algorithm&gt;</div><div class="line">...</div><div class="line">TCollection_Array1OfReal aValues = ...;</div><div class="line">...</div><div class="line">std::stable_sort (aValues.begin(), aValues.end());</div></div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_2dlayers"></a>
On-screen objects and ColorScale</h2>
<p>The old mechanism for rendering Underlay and Overlay on-screen 2D objects based on <em>Visual3d_Layer</em> and immediate drawing model (uncached and thus slow) has been removed. Classes <em>Aspect_Clayer2d, OpenGl_GraphicDriver_Layer, Visual3d_Layer, Visual3d_LayerItem, V3d_LayerMgr</em> and <em>V3d_LayerMgrPointer</em> have been deleted.</p>
<p>General <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s.html">AIS</a> interactive objects with transformation persistence flag <em>Graphic3d_TMF_2d</em> can be used as a replacement of <em>Visual3d_LayerItem</em>. The anchor point specified for transformation persistence defines the window corner of (or center in case of (0, 0) point). To keep on-screen 2D objects on top of the main screen, they can be assigned to the appropriate Z-layer. Predefined Z-layers <em>Graphic3d_ZLayerId_TopOSD</em> and <em>Graphic3d_ZLayerId_BotOSD</em> are intended to replace Underlay and Overlay layers within the old API.</p>
<p><em>ColorScale</em> object previously implemented using <em>Visual3d_LayerItem</em> has been moved to a new class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___color_scale.html">AIS_ColorScale</a></em>, with width and height specified explicitly. The property of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> storing the global <em>ColorScale</em> object has been removed with associated methods <em>V3d_View::ColorScaleDisplay(), V3d_View::ColorScaleErase(), V3d_View::ColorScaleIsDisplayed()</em> and <em>V3d_View::ColorScale()</em> as well as the classes <em>V3d_ColorScale, V3d_ColorScaleLayerItem</em> and <em>Aspect_ColorScale</em>. Here is an example of creating <em>ColorScale</em> using the updated API:</p>
<div class="fragment"><div class="line">Handle(AIS_ColorScale) aCS = new AIS_ColorScale();</div><div class="line">// configuring</div><div class="line">Standard_Integer aWidth, aHeight;</div><div class="line">aView-&gt;Window()-&gt;Size (aWidth, aHeight);</div><div class="line">aCS-&gt;SetSize              (aWidth, aHeight);</div><div class="line">aCS-&gt;SetRange             (0.0, 10.0);</div><div class="line">aCS-&gt;SetNumberOfIntervals (10);</div><div class="line">// displaying</div><div class="line">aCS-&gt;SetZLayer (Graphic3d_ZLayerId_TopOSD);</div><div class="line">aCS-&gt;SetTransformPersistence (Graphic3d_TMF_2d, gp_Pnt (-1,-1,0));</div><div class="line">aCS-&gt;SetToUpdate();</div><div class="line">theContextAIS-&gt;Display (aCS);</div></div><!-- fragment --><p>To see how 2d objects are implemented in OCCT you can call <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_draw.html">Draw</a> commands <em>vcolorscale, vlayerline</em> or <em>vdrawtext</em> (with <em>-2d</em> option). <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_draw.html">Draw</a> command <em>vcolorscale</em> now requires the name of <em>ColorScale</em> object as argument. To display this object use command <em>vdisplay</em>. For example:</p>
<div class="fragment"><div class="line">pload VISUALIZATION</div><div class="line">vinit</div><div class="line">vcolorscale cs -demo</div><div class="line">pload MODELING</div><div class="line">box b 100 100 100</div><div class="line">vdisplay b</div><div class="line">vsetdispmode 1</div><div class="line">vfit</div><div class="line">vlayerline 0 300 300 300 10</div><div class="line">vdrawtext t &quot;2D-TEXT&quot; -2d -pos 0 150 0 -color red</div></div><!-- fragment --><p>Here is a small example in C++ illustrating how to display a custom <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s.html">AIS</a> object in 2d: </p><div class="fragment"><div class="line">Handle(AIS_InteractiveContext) aContext = ...;</div><div class="line">Handle(AIS_InteractiveObject) anObj =...; // create an AIS object</div><div class="line">anObj-&gt;SetZLayer(Graphic3d_ZLayerId_TopOSD); // display object in overlay</div><div class="line">anObj-&gt;SetTransformPersistence (Graphic3d_TMF_2d, gp_Pnt (-1,-1,0)); // set 2d flag, coordinate origin is set to down-left corner</div><div class="line">aContext-&gt;Display (anObj); // display the object</div></div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_userdraw"></a>
UserDraw and Visual3d</h2>
<h4>Visual3d package</h4>
<p>Package <em>Visual3d</em> implementing the intermediate layer between high-level <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d.html">V3d</a></em> classes and low-level <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_open_gl.html">OpenGl</a> classes for views and graphic structures management has been dropped.</p>
<p>The <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___view.html">OpenGl_View</a></em> inherits from the new class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em>. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em> is an interface class that declares abstract methods for managing displayed structures, display properties and a base layer code that implements computation and management of HLR (or more broadly speaking view-depended) structures.</p>
<p>In the new implementation it takes place of the eliminated <em>Visual3d_View</em>. As before the instance of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em> is still completely managed by <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> classes. It can be accessed through <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> interface but normally it should not be required as all its methods are completely wrapped.</p>
<p>In more details, a concrete specialization of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em> is created and returned by the graphical driver on request. Right after the creation the views are directly used for setting rendering properties and adding graphical structures to be displayed.</p>
<p>The rendering of graphics is possible after mapping a window and activating the view. The direct setting of properties obsoletes the use of intermediate structures with display parameter like <em>Visual3d_ContextView</em>, etc. This means that the whole package <em>Visual3d</em> becomes redundant.</p>
<p>The functionality previously provided by <em>Visual3d</em> package has been redesigned in the following way :</p><ul>
<li>The management of display of structures has been moved from <em>Visual3d_ViewManager</em> into <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure_manager.html">Graphic3d_StructureManager</a></em>.</li>
<li>The class <em>Visual3d_View</em> has been removed. The management of computed structures has been moved into the base layer of <em>Graphi3d_CView</em>.</li>
<li>All intermediate structures for storing view parameters, e.g. <em>Visual3d_ContextView</em>, have been removed. The settings are now kept by instances of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a></em>.</li>
<li>The intermediate class <em>Visual3d_Light</em> has been removed. All light properties are stored in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/struct_graphic3d___c_light.html">Graphic3d_CLight</a></em> structure, which is directly accessed by instances of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___light.html">V3d_Light</a></em> classes.</li>
<li>All necessary enumerations have been moved into <em>Graphic3d</em> package.</li>
</ul>
<h4>Custom OpenGL rendering and UserDraw</h4>
<p>Old APIs based on global callback functions for creating <em>UserDraw</em> objects and for performing custom OpenGL rendering within the view have been dropped. <em>UserDraw</em> callbacks are no more required since <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___group.html">OpenGl_Group</a></em> now inherits <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___group.html">Graphic3d_Group</a></em> and thus can be accessed directly from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em>:</p>
<div class="fragment"><div class="line">//! Class implementing custom OpenGL element.</div><div class="line">class UserDrawElement : public OpenGl_Element {};</div><div class="line"></div><div class="line">//! Implementation of virtual method AIS_InteractiveObject::Compute().</div><div class="line">void UserDrawObject::Compute (const Handle(PrsMgr_PresentationManager3d)&amp; thePrsMgr,</div><div class="line">                              const Handle(Prs3d_Presentation)&amp; thePrs,</div><div class="line">                              const Standard_Integer theMode)</div><div class="line">{</div><div class="line">  Graphic3d_Vec4 aBndMin (myCoords[0], myCoords[1], myCoords[2], 1.0f);</div><div class="line">  Graphic3d_Vec4 aBndMax (myCoords[3], myCoords[4], myCoords[5], 1.0f);</div><div class="line"></div><div class="line">  // casting to OpenGl_Group should be always true as far as application uses OpenGl_GraphicDriver for rendering</div><div class="line">  Handle(OpenGl_Group) aGroup = Handle(OpenGl_Group)::DownCast (thePrs-&gt;NewGroup());</div><div class="line">  aGroup-&gt;SetMinMaxValues (aBndMin.x(), aBndMin.y(), aBndMin.z(),</div><div class="line">                           aBndMax.x(), aBndMax.y(), aBndMax.z());</div><div class="line">  UserDrawElement* anElem = new UserDrawElement (this);</div><div class="line">  aGroup-&gt;AddElement(anElem);</div><div class="line"></div><div class="line">  // invalidate bounding box of the scene</div><div class="line">  thePrsMgr-&gt;StructureManager()-&gt;Update();</div><div class="line">}</div></div><!-- fragment --><p>To perform a custom OpenGL code within the view, it is necessary to inherit from class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___view.html">OpenGl_View</a></em>. See the following code sample:</p>
<div class="fragment"><div class="line">//! Custom view.</div><div class="line">class UserView : public OpenGl_View</div><div class="line">{</div><div class="line">public:</div><div class="line">  //! Override rendering into the view.</div><div class="line">  virtual void render (Graphic3d_Camera::Projection theProjection,</div><div class="line">                       OpenGl_FrameBuffer*          theReadDrawFbo,</div><div class="line">                       const Standard_Boolean       theToDrawImmediate)</div><div class="line">  {</div><div class="line">    OpenGl_View::render (theProjection, theReadDrawFbo, theToDrawImmediate);</div><div class="line">    if (theToDrawImmediate)</div><div class="line">    {</div><div class="line">      return;</div><div class="line">    }</div><div class="line"></div><div class="line">    // perform custom drawing</div><div class="line">    const Handle(OpenGl_Context)&amp; aCtx = myWorkspace-&gt;GetGlContext();</div><div class="line">    GLfloat aVerts[3] = { 0.0f, 0,0f, 0,0f };</div><div class="line">    aCtx-&gt;core20-&gt;glEnableClientState(GL_VERTEX_ARRAY);</div><div class="line">    aCtx-&gt;core20-&gt;glVertexPointer(3, GL_FLOAT, 0, aVerts);</div><div class="line">    aCtx-&gt;core20-&gt;glDrawArrays(GL_POINTS, 0, 1);</div><div class="line">    aCtx-&gt;core20-&gt;glDisableClientState(GL_VERTEX_ARRAY);</div><div class="line">  }</div><div class="line"></div><div class="line">};</div><div class="line"></div><div class="line">//! Custom driver for creating UserView.</div><div class="line">class UserDriver : public OpenGl_GraphicDriver</div><div class="line">{</div><div class="line">public:</div><div class="line">  //! Create instance of own view.</div><div class="line">  virtual Handle(Graphic3d_CView) CreateView (const Handle(Graphic3d_StructureManager)&amp; theMgr) Standard_OVERRIDE</div><div class="line">  {</div><div class="line">    Handle(UserView) aView = new UserView (theMgr, this, myCaps, myDeviceLostFlag, &amp;myStateCounter);</div><div class="line">    myMapOfView.Add (aView);</div><div class="line">    for (TColStd_SequenceOfInteger::Iterator aLayerIt (myLayerSeq); aLayerIt.More(); aLayerIt.Next())</div><div class="line">    {</div><div class="line">      const Graphic3d_ZLayerId        aLayerID  = aLayerIt.Value();</div><div class="line">      const Graphic3d_ZLayerSettings&amp; aSettings = myMapOfZLayerSettings.Find (aLayerID);</div><div class="line">      aView-&gt;AddZLayer         (aLayerID);</div><div class="line">      aView-&gt;SetZLayerSettings (aLayerID, aSettings);</div><div class="line">    }</div><div class="line">    return aView;</div><div class="line">  }</div><div class="line">};</div></div><!-- fragment --><h2><a class="anchor" id="upgrade_occt700_localcontext"></a>
Deprecation of Local Context</h2>
<p>The conception of Local Context has been deprecated. The related classes, e.g. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___local_context.html">AIS_LocalContext</a></em>, and methods ( <em>AIS_InteractiveContext::OpenLocalContext()</em> and others) will be removed in a future OCCT release.</p>
<p>The main functionality provided by Local Context - selection of object subparts - can be now used within Neutral Point without opening any Local Context.</p>
<p>The property <em>SelectionMode()</em> has been removed from the class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em>. This property contradicts to selection logic, since it is allowed to activate several Selection modes at once. Therefore keeping one selection mode as object field makes no sense. Applications that used this method should implement selection mode caching at application level, if it is necessary for some reason.</p>
<h2><a class="anchor" id="upgrade_occt700_separate_caf_visualisation"></a>
Separation of visualization part from TKCAF</h2>
<p>Visualization CAF attributes have been moved into a new toolkit <em>TKVCAF</em>. If your application uses the classes from <em>TPrsStd</em> package then add link to <em>TKVCAF</em> library.</p>
<p>Version numbers of <em>BinOCAF</em> and <em>XmlOCAF</em> formats are incremented; new files cannot be read by earlier versions of OCCT.</p>
<p>Before loading the OCAF files saved by previous versions and containing <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_prs_std___a_i_s_presentation.html">TPrsStd_AISPresentation</a></em> attribute it is necessary to define the environment variable <em>CSF_MIGRATION_TYPES</em>, pointing to file <em>src/StdResources/MigrationSheet.txt</em>. When using documents loaded from a file, make sure to call method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_prs_std___a_i_s_viewer.html#ae717a74b1983565e9907e198c4818268">TPrsStd_AISViewer::New()</a></em> prior to accessing <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_prs_std___a_i_s_presentation.html">TPrsStd_AISPresentation</a></em> attributes in this document as that method creates them.</p>
<h2><a class="anchor" id="upgrade_euler_angles"></a>
Correction of interpretation of Euler angles in gp_Quaternion</h2>
<p>Conversion of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___quaternion.html">gp_Quaternion</a></em> to and from intrinsic Tait-Bryan angles (including <em>gp_YawPitchRoll</em>) is fixed.</p>
<p>Before that fix the sequence of rotation axes was opposite to the intended; e.g. <em>gp_YawPitchRoll</em> (equivalent to <em>gp_Intrinsic_ZYX</em>) actually defined intrinsic rotations around X, then Y, then Z. Now the rotations are made in the correct order.</p>
<p>The applications that use <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___quaternion.html">gp_Quaternion</a></em> to convert Yaw-Pitch-Roll angles (or other intrinsic Tait-Bryan sequences) may need to be updated to take this change into account.</p>
<h2><a class="anchor" id="upgrade_zoom_persistent_selection"></a>
Zoom Persistent Selection</h2>
<p>Zoom persistent selection introduces a new structure <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___transform_pers.html">Graphic3d_TransformPers</a></em> to transform persistence methods and parameters and a new class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___world_view_proj_state.html">Graphic3d_WorldViewProjState</a></em> to refer to the camera transformation state. You might need to update your code to deal with the new classes if you were using the related features. Please, keep in mind the following:</p><ul>
<li><em>Graphic3d_Camera::ModelViewState</em> has been renamed to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___camera.html#ab0389cda2b04b4202ecddf43707c71f4">Graphic3d_Camera::WorldViewState</a></em>.</li>
<li>Transformation matrix utilities from <em>OpenGl_Utils</em> namespace have been moved to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_graphic3d___transform_utils.html">Graphic3d_TransformUtils</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_graphic3d___transform_utils_8hxx.html">Graphic3d_TransformUtils.hxx</a></em> header respectively.</li>
<li>Matrix stack utilities from <em>OpenGl_Utils</em> namespace have been moved to <em>OpenGl_MatrixStack</em> class and <em>OpenGl_MatrixStack.hxx</em> header respectively.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___view.html">OpenGl_View</a></em> methods <em>Begin/EndTransformPersistence</em> have been removed. Please, use <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___transform_pers.html#a1bd5dae8781624c87b9ccea880946eab">Graphic3d_TransformPers::Apply()</a></em> instead to apply persistence to perspective and world-view projection matrices.</li>
</ul>
<h2><a class="anchor" id="upgrade_occt700_correction_of_texture"></a>
Texture mapping of objects</h2>
<p>Textured objects now have the priority over the environment mapping.</p>
<p>Redundant enumerations <em>V3d_TypeOfSurface</em> and <em>Graphic3d_TypeOfSurface</em>, class <em>OpenGl_SurfaceDetailState</em>, the corresponding methods from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html">Graphic3d_CView</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___shader_manager.html">OpenGl_ShaderManager</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___view.html">OpenGl_View</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html">V3d_Viewer</a></em> have been deleted. <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_draw.html">Draw</a> command <em>VSetTextureMode</em> has been deleted.</p>
<h2><a class="anchor" id="upgrade_occt700_wfshape"></a>
Shape presentation builders</h2>
<p>Presentation tools for building Wireframe presentation have been refactored to eliminate duplicated code and interfaces. Therefore, the following classes have been modified:</p><ul>
<li><em>StdPrs_WFDeflectionShape</em> and <em>Prs3d_WFShape</em> have been removed. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_std_prs___w_f_shape.html">StdPrs_WFShape</a></em> should be used instead.</li>
<li><em>StdPrs_ToolShadedShape</em> has been renamed to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_std_prs___tool_triangulated_shape.html">StdPrs_ToolTriangulatedShape</a></em>.</li>
</ul>
<h1><a class="anchor" id="upgrade_occt710"></a>
Upgrade to OCCT 7.1.0</h1>
<h2><a class="anchor" id="upgrade_710_aspects"></a>
Presentation attributes</h2>
<p>This section should be considered if application defines custom presentations, i.e. inherited from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em>. The previous versions of OCCT have three levels for defining presentation properties (e.g. colors, materials, etc.):</p>
<ol type="1">
<li>For the entire structure - <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure.html">Graphic3d_Structure</a></em> / <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs3d___presentation.html">Prs3d_Presentation</a></em>.</li>
<li>For a specific group of primitives - <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___group.html#a74b878aa96a309362bdb05f9f0923096">Graphic3d_Group::SetGroupPrimitivesAspect()</a></em> overriding structure aspects.</li>
<li>For a specific primitive array within the graphic group - <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___group.html#afe63fd1368e9aa93e299dec38d314309">Graphic3d_Group::SetPrimitivesAspect()</a></em>.</li>
</ol>
<p>The structure level has de facto not been used for a long time since OCCT presentations always define aspects at the graphic group level (overriding any structure aspects). Within this OCCT release, structure level of aspects has been completely removed. In most cases the application code should just remove missing methods. In those rare cases, when this functionality was intentionally used, the application should explicitly define aspects to the appropriate graphic groups.</p>
<p>Note that defining several different aspects within the same graphic group should also be avoided in the application code since it is a deprecated functionality which can be removed in further releases. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___group.html#a74b878aa96a309362bdb05f9f0923096">Graphic3d_Group::SetGroupPrimitivesAspect()</a></em> should be the main method defining presentation attributes.</p>
<p>The implementation of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___group.html#a74b878aa96a309362bdb05f9f0923096">Graphic3d_Group::SetGroupPrimitivesAspect()</a></em> has been changed from copying aspect values to keeping the passed object. Although it was not documented, previously it was possible to modify a single aspect instance, like <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___aspect_fill_area3d.html">Graphic3d_AspectFillArea3d</a></em> and set it to multiple groups. Now such code would produce an unexpected result and therefore should be updated to create the dedicated aspect instance.</p>
<h2><a class="anchor" id="upgrade_710_types"></a>
Typedefs</h2>
<p>The following type definitions in OCCT has been modified to use C++11 types:</p><ul>
<li><em>Standard_Boolean</em> is now <em>bool</em> (previously <em>unsigned int</em>).</li>
<li><em>Standard_ExtCharacter</em> is now <em>char16_t</em> (previously <em>short</em>).</li>
<li><em>Standard_ExtString;</em> is now <em>const char16_t</em> (previously <em>const short</em>).</li>
<li><em>Standard_Utf16Char</em> is now <em>char16_t</em> (previously <em>uint16_t</em> for compatibility with old compilers).</li>
<li><em>Standard_Utf32Char</em> is now <em>char32_t</em> (previously <em>uint32_t</em> for compatibility with old compilers).</li>
</ul>
<p>For most applications this change should be transparent on the level of source code. Binary compatibility is not maintained, as <em>bool</em> has a different size in comparison with <em>unsigned int</em>.</p>
<h2><a class="anchor" id="upgrade_710_ffp"></a>
Programmable Pipeline</h2>
<p>Fixed-function pipeline has been already deprecated since OCCT 7.0.0. Release 7.1.0 disables this functionality by default in favor of Programmable Pipeline (based on GLSL programs).</p>
<p>Method <em>V3d_View::Export()</em>, based on <em>gl2ps</em> library, requires fixed pipeline and will return error if used with default settings. Applications should explicitly enable fixed pipeline by setting <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___caps.html#ac7ecaf4c9ee843771851cc06129f72f2">OpenGl_Caps::ffpEnable</a></em> flag to TRUE within <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___graphic_driver.html#abcb0ea80381009ab6ff334c005012956">OpenGl_GraphicDriver::ChangeOptions()</a></em> before creating the viewer to use <em>V3d_View::Export()</em>. This method is declared as deprecated and will be removed in one of the the next OCCT releases. The recommended way to generate a vector image of a 3D model or scene is to use an application-level solution independent from OpenGL.</p>
<h2><a class="anchor" id="upgrade_710_trsfpers"></a>
Transformation persistence</h2>
<p>The behavior of transformation persistence flags <em>Graphic3d_TMF_ZoomPers</em> and <em>Graphic3d_TMF_TriedronPers</em> has been changed for consistency with a textured fixed-size 2D text. An object with these flags is considered as defined in pixel units, and the presentation is no more scaled depending on the view height. The applications that need to scale such objects depending on viewport size should update them manually.</p>
<p>Flags <em>Graphic3d_TMF_PanPers</em> and <em>Graphic3d_TMF_FullPers</em> have been removed. <em>Graphic3d_TMF_TriedronPers</em> or <em>Graphic3d_TMF_2d</em> can be used instead depending on the context.</p>
<p><em>Graphic3d_TransModeFlags</em> is not an integer bitmask anymore - enumeration values should be specified instead. Several transformation persistence methods in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html">PrsMgr_PresentableObject</a></em> have been marked deprecated. Transformation persistence should be defined using <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___transform_pers.html">Graphic3d_TransformPers</a></em> constructor directly and passed by a handle, not value.</p>
<h2><a class="anchor" id="upgrade_710_selprops"></a>
Dynamic highlight and selection properties</h2>
<p>Release 7.1.0 introduces <em>Graphic3d_HighlightStyle</em> - an entity that allows flexible customization of highlighting parameters (such as highlighting method, color, and transparency). Therefore, the signatures of the following methods related to highlighting:</p><ul>
<li><em>AIS_InteractiveContext::Hilight()</em>;</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#aee271acaf4093aadf7454943cb71fa16">AIS_InteractiveContext::HilightWithColor()</a></em>;</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentation_manager.html#a7e6c79243163771cc7447cd46868aa20">PrsMgr_PresentationManager::Color()</a></em>;</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___entity_owner.html#a333655a7c0f45f5b05115761ea379b26">SelectMgr_EntityOwner::HilightWithColor()</a></em>; have been changed to receive <em>Graphic3d_HighlightStyle</em> instead of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_quantity___color.html">Quantity_Color</a></em>.</li>
</ul>
<p>Method <em>AIS_InteractiveContext::Hilight</em> is now deprecated and highlights the interactive object with selection style.</p>
<p>A group of methods <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#adef590fa98ae629fd916b9179394a94f">AIS_InteractiveContext::IsHilighted</a></em> has changed its behavior - now they only check highlight flags of the object or the owner in the global status. If the highlight color is required on the application level, it is necessary to use overloaded methods <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#a0291c27cde72c502551592943304d15a">AIS_InteractiveContext::HighlightStyle</a></em> for the owner and the object.</p>
<p>The following methods have been replaced in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a></em> class:</p><ul>
<li><em>HilightColor</em> and <em>SetHilightColor</em> by <em>HighlightStyle</em> and <em>SetHighlightStyle</em>;</li>
<li><em>SelectionColor</em> setter and getter by <em>SelectionStyle</em> and <em>SetSelectionStyle</em>.</li>
</ul>
<p>The API of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs3d___drawer.html">Prs3d_Drawer</a></em> has been extended to allow setting up styles for both dynamic selection and highlighting. Therefore, it is possible to change the highlight style of a particular object on the application level via <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html#a1a1f01aa8822a520d0c4af9599b573b7">SelectMgr_SelectableObject::HilightAttributes()</a></em> and process it in the entity owner.</p>
<h2><a class="anchor" id="upgrade_occt710_correction_of_TObj_Model"></a>
Correction in TObj_Model class</h2>
<p>Methods <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html#afc1b25e2badfd0862b9af249e3f95a37">TObj_Model::SaveAs</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html#a0664a8e02756728753b119e8f131c22f">TObj_Model::Load</a></em> now receive <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___extended_string.html">TCollection_ExtendedString</a></em> filename arguments instead of char*. UTF-16 encoding can be used to pass file names containing Unicode symbols.</p>
<h2><a class="anchor" id="upgrade_710_env"></a>
Redundant environment variables</h2>
<p>The following environment variables have become redundant:</p>
<ul>
<li><em>CSF_UnitsLexicon</em> and <em>CSF_UnitsDefinition</em> are no more used. <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_units.html">Units</a> definition (<em>UnitsAPI/Lexi_Expr.dat</em> and <em>UnitsAPI/Units.dat</em>) is now embedded into source code.</li>
<li><em>CSF_XSMessage</em> and <em>CSF_XHMessage</em> are now optional. English messages (XSMessage/*XSTEP.us* and SHMessage/*SHAPE.us*) are now embedded into source code and automatically loaded when environment variables are not set.</li>
<li><em>CSF_ShadersDirectory</em> is not required any more, though it still can be used to load custom shaders. Mandatory GLSL resources are now embedded into source code.</li>
<li><em>CSF_PluginDefaults</em> and other variables pointing to OCAF plugin resources (<em>CSF_StandardDefaults</em>, <em>CSF_XCAFDefaults</em>, <em>CSF_StandardLiteDefaults</em> and <em>CSF_XmlOcafResource</em>) are not necessary if method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_doc_std___application.html#aa534aa416b6895610b4e30af63c3800d">TDocStd_Application::DefineFormat()</a></em> is used to enable persistence of OCAF documents.</li>
</ul>
<p>Other environment variables still can be used to customize behavior of relevant algorithms but are not necessary any more (all required resources are embedded).</p>
<h2><a class="anchor" id="upgrade_710_removed"></a>
Removed features</h2>
<p>The following obsolete features have been removed:</p><ul>
<li>Anti-aliasing API <em>V3d_View::SetAntialiasingOn()</em>. This method was intended to activate deprecated OpenGL functionality <em>GL_POLYGON_SMOOTH, GL_LINE_SMOOTH</em> and <em>GL_POINT_SMOOTH</em>. Instead of the old API, the application should request MSAA buffers for anti-aliasing by assigning <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___rendering_params.html#ad9748bb41b91ebbf6c0cd346a590ec15">Graphic3d_RenderingParams::NbMsaaSamples</a></em> property of the structure returned by <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#ac62c6d1d0bbc13715b9730b5e12b1e41">V3d_View::ChangeRenderingParams()</a></em>.</li>
<li><em>Prs3d_Drawer::ShadingAspectGlobal()</em> flag has been removed as not used. The corresponding calls can be removed safely from the application code.</li>
<li>The methods managing ZClipping planes and ZCueing: <em>V3d_View::SetZClippingType()</em>, <em>V3d_View::SetZCueingOn()</em>, etc. have been removed. ZClipping planes can be replaced by general-purpose clipping planes (the application should update plane definition manually).</li>
<li>The 3D viewer printing API <em>V3d_View::Print()</em> has been removed. This functionality was available on Windows platforms only. The applications should use the general image dump API <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#a0996589af89ab083e2c3ce0b49653521">V3d_View::ToPixMap()</a></em> and manage printing using a platform-specific API at the application level. Text resolution can be managed by rendering parameter <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___rendering_params.html#a3fcc0cb3a9e4ad96b75438564d71641f">Graphic3d_RenderingParams::Resolution</a></em>, returned by <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html#ac62c6d1d0bbc13715b9730b5e12b1e41">V3d_View::ChangeRenderingParams()</a></em>.</li>
<li>Methods <em>PrsMgr_PresentationManager::BoundBox</em>, <em>PrsMgr_PresentationManager::Hilight</em> and <em>SelectMgr_EntityOwner::Hilight</em> have been removed as not used. The corresponding method in custom implementations of <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_select_mgr___entity_owner.html">SelectMgr_EntityOwner</a></em> can be removed safely. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentation_manager.html#a7e6c79243163771cc7447cd46868aa20">PrsMgr_PresentationManager::Color</a></em> with the corresponding style must be used instead.</li>
<li>Class <em>NCollection_QuickSort</em> has been removed. The code that used the tools provided by that class should be corrected manually. The recommended approach is to use sorting algorithms provided by STL (std::sort). See also <a class="el" href="occt_dev_guides__upgrade.html#upgrade_occt700_sorttools">Removal of SortTools package</a> above.</li>
<li>Package <em>Dico</em>. The code that used the tools provided by that package should be corrected manually. The recommended approach is to use <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_n_collection___data_map.html">NCollection_DataMap</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_n_collection___indexed_data_map.html">NCollection_IndexedDataMap</a></em> classes.</li>
</ul>
<h2><a class="anchor" id="upgrade_710_changed_methods"></a>
Other changes</h2>
<p>The following classes have been changed:</p>
<ul>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_v_h___sorter.html">BVH_Sorter</a></em> class has become abstract. The list of arguments of both <em>Perform</em> methods has been changed and the methods became pure virtual.</li>
<li><em>Extrema_FuncExtPS</em> has been renamed to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_extrema___func_p_s_norm.html">Extrema_FuncPSNorm</a></em>.</li>
<li>The default constructor and the constructor taking a point and a surface have been removed from class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_extrema___gen_locate_ext_p_s.html">Extrema_GenLocateExtPS</a></em>. Now the only constructor takes the surface and optional tolerances in U and V directions. The new method <em>Perform</em> takes the point with the start solution and processes it. The class has become not assignable and not copy-constructable.</li>
<li>Constructors with arguments *(const <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___ax22d.html">gp_Ax22d</a>&amp; D, const <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___pnt2d.html">gp_Pnt2d</a>&amp; F)* have been removed from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_g_c_e2d___make_parabola.html">GCE2d_MakeParabola</a></em>, <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgce___make_parab2d.html">gce_MakeParab2d</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___parab2d.html">gp_Parab2d</a></em>. The objects created with some constructors of class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___parab2d.html">gp_Parab2d</a></em> may differ from the previous version (see the comments in <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/gp___parab2d_8hxx.html">gp_Parab2d.hxx</a></em>). The result returned by <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classgp___parab2d.html#a9180e8a59b24e5ccdf9ce65730585613">gp_Parab2d::Directrix()</a></em> method has an opposite direction in comparison with the previous OCCT versions.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_tools___modifier.html">BRepTools_Modifier</a></em> class now has two modes of work. They are defined by the boolean parameter <em>MutableInput</em>, which is turned off by default. This means that the algorithm always makes a copy of a sub-shape (e.g. vertex) if its tolerance is to be increased in the output shape. The old mode corresponds to <em>MutableInput</em> turned on. This change may impact an application if it implements a class derived from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_tools___modifier.html">BRepTools_Modifier</a></em>.</li>
<li>The second parameter <em>theIsOuterWire</em> of method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_shape_analysis___wire.html#a6b1ba072360739e46ca84a6628fbccec">ShapeAnalysis_Wire::CheckSmallArea</a></em> has been removed.</li>
<li>In class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom_plate___curve_constraint.html">GeomPlate_CurveConstraint</a></em>, two constructors taking boundary curves of different types have been replaced with one constructor taking the curve of an abstract type.</li>
<li>The last optional argument <em>RemoveInvalidFaces</em> has been removed from the constructor of class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset___make_offset.html">BRepOffset_MakeOffset</a></em> and method <em>Initialize</em>.</li>
<li>The public method <em>BOPDS_DS::VerticesOnIn</em> has been renamed into <em>SubShapesOnIn</em> and the new output parameter <em>theCommonPB</em> has been added.</li>
</ul>
<h1><a class="anchor" id="upgrade_occt720"></a>
Upgrade to OCCT 7.2.0</h1>
<h2><a class="anchor" id="upgrade_720_removed"></a>
Removed features</h2>
<p>The following obsolete features have been removed:</p><ul>
<li><em>AIS_InteractiveContext::PreSelectionColor()</em>, <em>DefaultColor()</em>, <em>WasCurrentTouched()</em>, <em>ZDetection()</em>. These properties were unused, and therefore application should remove occurrences of these methods.</li>
<li><em>AIS_InteractiveObject::SelectionPriority()</em>. These property was not implemented.</li>
<li>The class <em>LocOpe_HBuilder</em> has been removed as obsolete.</li>
<li>The package <em>TestTopOpe</em> has been removed;</li>
<li>The package <em>TestTopOpeDraw</em> has been removed;</li>
<li>The package <em>TestTopOpeTools</em> has been removed.</li>
<li>The packages <em>QANewModTopOpe</em>, <em>QANewBRepNaming</em> and <em>QANewDBRepNaming</em> have been removed as containing obsolete features.</li>
<li>The following methods of the <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_int_polyh___triangle.html">IntPolyh_Triangle</a></em> class have been removed as unused:<ul>
<li><em>CheckCommonEdge</em></li>
<li><em>SetEdgeandOrientation</em></li>
<li><em>MultipleMiddleRefinement2</em>.</li>
</ul>
</li>
<li>The method <em>IntPolyh_Triangle::TriangleDeflection</em> has been renamed to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_int_polyh___triangle.html#a6fc05f59ddc9d048b15e2cf0e66787e5">IntPolyh_Triangle::ComputeDeflection</a></em>.</li>
<li>The following methods of the <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_int_polyh___maillage_affinage.html">IntPolyh_MaillageAffinage</a></em> class have been removed as unused:<ul>
<li><em>LinkEdges2Triangles</em>;</li>
<li><em>TriangleEdgeContact2</em>;</li>
<li><em>StartingPointsResearch2</em>;</li>
<li><em>NextStartingPointsResearch2</em>;</li>
<li><em>TriangleComparePSP</em>;</li>
<li><em>StartPointsCalcul</em>.</li>
</ul>
</li>
<li>The method PerformAdvanced of the <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_shape_construct___project_curve_on_surface.html">ShapeConstruct_ProjectCurveOnSurface</a></em> class has been removed as unused.</li>
<li>The method Perform of the <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_shape_construct___project_curve_on_surface.html">ShapeConstruct_ProjectCurveOnSurface</a></em> class is modified:<ul>
<li>input arguments <em>continuity</em>, <em>maxdeg</em>, <em>nbinterval</em> have been removed as unused;</li>
<li>input arguments <em>TolFirst</em>, <em>TolLast</em> have been added at the end of arguments' list.</li>
</ul>
</li>
<li>Typedefs Quantity_Factor, Quantity_Parameter, Quantity_Ratio, Quantity_Coefficient, Quantity_PlaneAngle, Quantity_Length, V3d_Parameter and V3d_Coordinate have been removed; Standard_Real should be used instead.</li>
</ul>
<h2><a class="anchor" id="upgrade_occt720_reshape_oriented_removed"></a>
Corrections in BRepOffset API</h2>
<p>In classes <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_tools___re_shape.html">BRepTools_ReShape</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_shape_build___re_shape.html">ShapeBuild_ReShape</a></em>, the possibility to process shapes different only by orientation in different ways has been removed. Thus methods <em>Remove()</em> and <em>Replace()</em> do not have any more the last argument 'oriented'; they work always as if <em>Standard_False</em> was passed before (default behavior). Methods <em>ModeConsiderLo()</em> and <em>Apply()</em> with three arguments have been removed.</p>
<h2><a class="anchor" id="upgrade_occt720_correction_of_Offset_API"></a>
Corrections in BRepOffset API</h2>
<p>Class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_offset_shape.html">BRepOffsetAPI_MakeOffsetShape</a></em>:</p><ul>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_offset_shape.html#ac06886770a35f9f847d02bb6b7e7826b">BRepOffsetAPI_MakeOffsetShape::BRepOffsetAPI_MakeOffsetShape()</a></em> - constructor with parameters has been deleted.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_offset_shape.html#a23130ef38ae1b07bc2eca631385ac9be">BRepOffsetAPI_MakeOffsetShape::PerformByJoin()</a></em> - method has been added. This method is old algorithm behaviour.</li>
</ul>
<p>The code below shows new calling procedure: </p><div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_offset_shape.html">BRepOffsetAPI_MakeOffsetShape</a> OffsetMaker;</div><div class="line">OffsetMaker.<a class="codeRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_offset_shape.html#a23130ef38ae1b07bc2eca631385ac9be">PerformByJoin</a>(Shape, OffsetValue, Tolerance);</div><div class="line">NewShape = OffsetMaker.<a class="codeRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_builder_a_p_i___make_shape.html#a5b5b6e22f99b84ee579f163ce4ffd9a9">Shape</a>();</div></div><!-- fragment --><p>Class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_thick_solid.html">BRepOffsetAPI_MakeThickSolid</a></em>:</p><ul>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_thick_solid.html#a590d0fe2bdd608583b4024a652be06de">BRepOffsetAPI_MakeThickSolid::BRepOffsetAPI_MakeThickSolid()</a></em> - constructor with parameters has been deleted.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_thick_solid.html#a96e66fd6d047d844eb6f261b86e0a9a5">BRepOffsetAPI_MakeThickSolid::MakeThickSolidByJoin()</a></em> - method has been added. This method is old algorithm behaviour.</li>
</ul>
<p>The code below shows new calling procedure: </p><div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_thick_solid.html">BRepOffsetAPI_MakeThickSolid</a> BodyMaker;</div><div class="line">BodyMaker.<a class="codeRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_offset_a_p_i___make_thick_solid.html#a96e66fd6d047d844eb6f261b86e0a9a5">MakeThickSolidByJoin</a>(myBody, facesToRemove, -myThickness / 50, 1.e-3);</div><div class="line">myBody = BodyMaker.<a class="codeRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_builder_a_p_i___make_shape.html#a5b5b6e22f99b84ee579f163ce4ffd9a9">Shape</a>();</div></div><!-- fragment --><h2><a class="anchor" id="upgrade_720_highlight"></a>
Highlight style</h2>
<p>Management of highlight attributes has been revised and might require modifications from application side:</p><ul>
<li>New class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___presentation_attributes.html">Graphic3d_PresentationAttributes</a></em> defining basic presentation attributes has been introduced. It's definition includes properties previously defined by class Graphic3d_HighlightStyle (<em>Color</em>, <em>Transparency</em>), and new properties (<em>Display mode</em>, <em>ZLayer</em>, optional <em>FillArea aspect</em>).</li>
<li>Class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs3d___drawer.html">Prs3d_Drawer</a></em> now inherits class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___presentation_attributes.html">Graphic3d_PresentationAttributes</a></em>. So that overall presentation attributes are now split into two parts - Basic attributes and Detailed attributes.</li>
<li>Class <em>Graphic3d_HighlightStyle</em> has been dropped. It is now defined as a typedef to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs3d___drawer.html">Prs3d_Drawer</a></em>. Therefore, highlight style now also includes not only Basic presentation attributes, but also Detailed attributes which can be used by custom presentation builders.</li>
<li>Highlighting style defined by class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___presentation_attributes.html">Graphic3d_PresentationAttributes</a></em> now provides more options:<ul>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___presentation_attributes.html#acfefd6c3745c1d486e8083bbfe414d79">Graphic3d_PresentationAttributes::BasicFillAreaAspect()</a></em> property providing complete Material definition. This option, when defined, can be used instead of the pair Object Material + Highlight Color.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___presentation_attributes.html#ad867008b740f4dc9d29f58a3f750c460">Graphic3d_PresentationAttributes::ZLayer()</a></em> property specifying the Layer where highlighted presentation should be shown. This property can be set to Graphic3d_ZLayerId_UNKNOWN, which means that ZLayer of main presentation should be used instead.</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___presentation_attributes.html#afbe084a82d2a9bebcad4bd0b39461383">Graphic3d_PresentationAttributes::DisplayMode()</a></em> property specifying Display Mode for highlight presentation.</li>
</ul>
</li>
<li>Since Highlight and Selection styles within <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a></em> are now defined by <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs3d___drawer.html">Prs3d_Drawer</a></em> inheriting from <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___presentation_attributes.html">Graphic3d_PresentationAttributes</a></em>, it is now possible to customize default highlight attributes like <em>Display Mode</em> and <em>ZLayer</em>, which previously could be defined only on Object level.</li>
<li>Properties <em>Prs3d_Drawer::HighlightStyle()</em> and <em>Prs3d_Drawer::SelectionStyle()</em> have been removed. Instead, <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em> now defines <em>DynamicHilightAttributes()</em> for dynamic highlighting in addition to <em>HilightAttributes()</em> used for highlighting in selected state. Note that <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html#a1a1f01aa8822a520d0c4af9599b573b7">AIS_InteractiveObject::HilightAttributes()</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html#aa7f5dfdea42663ddf928007295d48467">AIS_InteractiveObject::DynamicHilightAttributes()</a></em> override highlighting properties for both - entire object and for part coming from decomposition. This includes Z-layer settings, which will be the same when overriding properties through <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a>, while <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html#a0291c27cde72c502551592943304d15a">AIS_InteractiveContext::HighlightStyle()</a></em> allows customizing properties for local and global selection independently (with Graphic3d_ZLayerId_Top used for dynamic highlighting of entire object and Graphic3d_ZLayerId_Topmost for dynamic highlighting of object part by default).</li>
<li>The following protected fields have been removed from class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_object.html">AIS_InteractiveObject</a></em>:<ul>
<li><em>myOwnColor</em>, replaced by <em>myDrawer-&gt;Color()</em></li>
<li><em>myTransparency</em>, replaced by <em>myDrawer-&gt;Transparency()</em></li>
<li><em>myZLayer</em>, replaced by <em>myDrawer-&gt;ZLayer()</em></li>
</ul>
</li>
<li>The method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentation_manager.html#a40d9cd6d5256533bad97422b86f6591a">PrsMgr_PresentationManager::Unhighlight()</a></em> taking Display Mode as an argument has been marked deprecated. Implementation now performs unhighlighting of all highlighted presentation mode.</li>
<li>The methods taking/returning <em>Quantity_NameOfColor</em> (predefined list of colors) and duplicating methods operating with <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_quantity___color.html">Quantity_Color</a></em> (definition of arbitrary RGB color) in <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s.html">AIS</a> have been removed. <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_quantity___color.html">Quantity_Color</a></em> should be now used instead.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_implicit_viewer_update"></a>
Elimination of implicit 3D Viewer updates</h2>
<p>Most <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a> methods are defined with a flag to update viewer immediatly or not. Within previous version of OCCT, this argument had default value TRUE. While immediate viewer updates are useful for beginners (the result is displayed as soon as possible), this approach is inefficent for batch viewer updates, and having default value as TRUE leaded to non-intended accidential updates which are difficult to find.</p>
<p>To avoid such issues, the interface has been modified and default value has been removed. Therefore, old application code should be updated to set the flag theToUpdateViewer explicitly to desired value (TRUE to preserve old previous behavior), if it was not already set.</p>
<p>The following <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___interactive_context.html">AIS_InteractiveContext</a> methods have been changed: Display, Erase, EraseAll, DisplayAll, EraseSelected, DisplaySelected, ClearPrs, Remove, RemoveAll, Hilight, HilightWithColor, Unhilight, Redisplay, RecomputePrsOnly, Update, SetDisplayMode, UnsetDisplayMode, SetColor, UnsetColor, SetWidth, UnsetWidth, SetMaterial, UnsetMaterial, SetTransparency, UnsetTransparency, SetLocalAttributes, UnsetLocalAttributes, SetPolygonOffsets, SetTrihedronSize, SetPlaneSize, SetPlaneSize, SetDeviationCoefficient, SetDeviationAngle, SetAngleAndDeviation, SetHLRDeviationCoefficient, SetHLRDeviationAngle, SetHLRAngleAndDeviation, SetSelectedAspect, MoveTo, Select, ShiftSelect, SetSelected, UpdateSelected, AddOrRemoveSelected, HilightSelected, UnhilightSelected, ClearSelected, ResetOriginalState, SubIntensityOn, SubIntensityOff, FitSelected, EraseGlobal, ClearGlobal, ClearGlobalPrs.</p>
<p>In addition, the API for immediate viewer update has been removed from <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___view.html">V3d_View</a> and <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___structure_manager.html">Graphic3d_StructureManager</a> classes (enumerations <em>Aspect_TypeOfUpdate</em> and <em>V3d_TypeOfUpdate</em>): V3d::SetUpdateMode(), V3d::UpdateMode(), Graphic3d_StructureManager::SetUpdateMode(), Graphic3d_StructureManager::UpdateMode().</p>
<p>The argument theUpdateMode has been removed from methods Graphic3d_CView::Display(), Erase(), Update(). Method <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_graphic3d___c_view.html#a7bda5ca8037366a522ca7e3d0857c80b">Graphic3d_CView::Update()</a> does not redraw the view and does not re-compute structures anymore.</p>
<p>The following Grid management methods within class <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_v3d___viewer.html">V3d_Viewer</a> do not implicitly redraw the viewer: ActivateGrid, DeactivateGrid, SetRectangularGridValues, SetCircularGridValues, RectangularGridGraphicValues, CircularGridGraphicValues, SetPrivilegedPlane, DisplayPrivilegedPlane.</p>
<h2><a class="anchor" id="upgrade_720_v3d_colorname"></a>
Elimination of Quantity_NameOfColor from TKV3d interface classes</h2>
<p>The duplicating interface methods accepting <em>Quantity_NameOfColor</em> (in addition to methods accepting <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_quantity___color.html">Quantity_Color</a></em>) of TKV3d toolkit have been removed. In most cases this change should be transparent, however applications implementing such interface methods should also remove them (compiler will automatically highlight this issue for methods marked with Standard_OVERRIDE keyword).</p>
<h2><a class="anchor" id="upgrade_720_Result_Of_BOP_On_Containers"></a>
Result of Boolean operations on containers</h2>
<ul>
<li>The result of Boolean operations on arguments of collection types (WIRE/SHELL/COMPSOLID) is now filtered from duplicating containers.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_changes_methods"></a>
Other changes</h2>
<ul>
<li><em>MMgt_TShared</em> class definition has been removed - <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___transient.html">Standard_Transient</a> should be used instead (MMgt_TShared is marked as deprecated typedef of <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___transient.html">Standard_Transient</a> for smooth migration).</li>
<li>Class <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_geom_plate___build_plate_surface.html">GeomPlate_BuildPlateSurface</a> accepts base class <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_adaptor3d___h_curve.html">Adaptor3d_HCurve</a> (instead of inherited <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_adaptor3d___h_curve_on_surface.html">Adaptor3d_HCurveOnSurface</a> accepted earlier).</li>
<li>Types GeomPlate_Array1OfHCurveOnSurface and GeomPlate_HArray1OfHCurveOnSurface have been replaced with GeomPlate_Array1OfHCurve and GeomPlate_HArray1OfHCurve correspondingly (accept base class <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_adaptor3d___h_curve.html">Adaptor3d_HCurve</a> instead of <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_adaptor3d___h_curve_on_surface.html">Adaptor3d_HCurveOnSurface</a>).</li>
<li>Enumeration <em>Image_PixMap::ImgFormat</em>, previously declared as nested enumeration within class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html">Image_PixMap</a></em>, has been moved to global namespace as <em>Image_Format</em> following OCCT coding rules. The enumeration values have suffix Image_Format_ and preserve previous name scheme for easy renaming of old values - e.g. <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html#aaec040a237136b71b85becd2e5a00c7a">Image_PixMap::ImgGray</a> become Image_Format_Gray. Old definitions are preserved as depreacated aliases to the new ones;</li>
<li>Methods <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html#af82a15b322c18b2611c3b2c77e8b6c7f">Image_PixMap::PixelColor()</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_image___pix_map.html#a3369c0b35429637c5a04a9eb1134ee26">Image_PixMap::SetPixelColor()</a></em> now take/return <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_quantity___color_r_g_b_a.html">Quantity_ColorRGBA</a> instead of Quantity_Color/NCollection_Vec4.</li>
<li>The method <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_algo___builder.html#acfede95254961d6680cba7abe3b3cbc6">BOPAlgo_Builder::Origins()</a> returns BOPCol_DataMapOfShapeListOfShape instead of BOPCol_DataMapOfShapeShape.</li>
<li>The methods BOPDS_DS::IsToSort(const Handle(BOPDS_CommonBlock)&amp;, Standard_Integer&amp;) and BOPDS_DS::SortPaveBlocks(const Handle(BOPDS_CommonBlock)&amp;) have been removed. The sorting is now performed during the addition of the Pave Blocks into Common Block.</li>
<li>The methods <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_algo___tools.html#ac91f6baf2b7e3969414700385c2fb145">BOPAlgo_Tools::MakeBlocks()</a> and BOPAlgo_Tools::MakeBlocksCnx() have been replaced with the single template method <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_algo___tools.html#ac91f6baf2b7e3969414700385c2fb145">BOPAlgo_Tools::MakeBlocks()</a>. The chains of connected elements are now stored into the list of list instead of data map.</li>
<li>The methods <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_algo___tools.html#abbeee9568fa5e9fb5a1a7ad4da2ea255">BOPAlgo_Tools::FillMap()</a> have been replaced with the single template method <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_algo___tools.html#abbeee9568fa5e9fb5a1a7ad4da2ea255">BOPAlgo_Tools::FillMap()</a>.</li>
<li>Package <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> now uses <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/classopencascade_1_1handle.html">opencascade::handle</a> instead of <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_n_collection___handle.html">NCollection_Handle</a> (for classes <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_v_h___properties.html">BVH_Properties</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_v_h___builder.html">BVH_Builder</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_v_h___tree.html">BVH_Tree</a>, <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_v_h___object.html">BVH_Object</a>). Application code using <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/namespace_b_v_h.html">BVH</a> package directly should be updated accordingly.</li>
<li><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___shape.html">AIS_Shape</a> now computes UV texture coordinates for AIS_Shaded presentation in case if texture mapping is enabled within Shaded Attributes. Therefore, redundant class <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___textured_shape.html">AIS_TexturedShape</a> is now deprecated</em> - applications can use <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_a_i_s___shape.html">AIS_Shape</a></em> directly (texture mapping should be defined through <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_prs_mgr___presentable_object.html#a0d375d53b2a5efcee7cf66fba42ef710">AIS_Shape::Attributes()</a>).</li>
<li>Methods for managing active texture within <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___workspace.html">OpenGl_Workspace</a> class (ActiveTexture(), DisableTexture(), EnableTexture()) have been moved to <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_open_gl___context.html#ae105fbfb83f9604b197c1115ce3febdc">OpenGl_Context::BindTextures()</a></em>.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_BOP_DataStructure"></a>
BOP - Pairs of interfering indices</h2>
<ul>
<li>The classes <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_d_s___pass_key.html">BOPDS_PassKey</a></em> and <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_d_s___pass_key_boolean.html">BOPDS_PassKeyBoolean</a></em> are too excessive and not used any more in Boolean Operations. To replace them the new <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_d_s___pair.html">BOPDS_Pair</a></em> class has been implemented. Thus:<ul>
<li>The method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_d_s___d_s.html#a4ba3a1da07342cd2e876416693e8fedd">BOPDS_DS::Interferences()</a></em> now returns the <em>BOPDS_MapOfPair</em>;</li>
<li>The method <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_o_p_d_s___iterator.html#a52a6377ac147e96c2c6afbdb9df53e88">BOPDS_Iterator::Value()</a></em> takes now only two parameters - the indices of interfering sub-shapes.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="upgrade_720_Removal_Of_Old_Boolean_Operations_Draw"></a>
Removal of the Draw commands based on old Boolean operations</h2>
<ul>
<li>The commands <em>fubl</em> and <em>cubl</em> have been removed. The alternative for these commands are the commands <em>bfuseblend</em> and <em>bcutblend</em> respectively.</li>
<li>The command <em>ksection</em> has been removed. The alternative for this command is the command <em>bsection</em>.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_Change_Of_FaceFace_Intersection"></a>
Change of Face/Face intersection in Boolean operations</h2>
<ul>
<li>Previously, the intersection tolerance for all section curves between pair of faces has been calculated as the maximal tolerance among all curves. Now, each curve has its own valid tolerance calculated as the maximal deviation of the 3D curve from its 2D curves or surfaces in case there are no 2D curves.</li>
<li>The methods <em>IntTools_FaceFace::TolReached3d()</em>, <em>IntTools_FaceFace::TolReal()</em> and <em>IntTools_FaceFace::TolReached2d()</em> have been removed.</li>
<li>Intersection tolerances of the curve can be obtained from the curve itself:<ul>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_int_tools___curve.html#a928378fbe901546b6e4ec631dcbf6757">IntTools_Curve::Tolerance()</a></em> - returns the valid tolerance for the curve;</li>
<li><em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_int_tools___curve.html#a2f83e7b516b72758f5b9c44b11b60005">IntTools_Curve::TangentialTolerance()</a></em> - returns the tangential tolerance, which reflects the size of the common between faces.</li>
</ul>
</li>
<li>2d tolerance (<em>IntTools_FaceFace::TolReached2d()</em>) has been completely removed from the algorithm as unused.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_persistence"></a>
Restore OCCT 6.9.1 persistence</h2>
<p>The capability of reading / writing files in old format using <em>Storage_ShapeSchema</em> functionality from OCCT 6.9.1 has been restored in OCCT 7.2.0.</p>
<p>One can use this functionality in two ways:</p><ul>
<li>invoke DRAW Test Harness commands <em>fsdread / fsdwrite</em> for shapes;</li>
<li>call <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_std_storage.html">StdStorage</a></em> class <em>Read / Write</em> functions in custom code.</li>
</ul>
<p>The code example below demonstrates how to read shapes from a storage driver using <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_std_storage.html">StdStorage</a></em> class.</p>
<div class="fragment"><div class="line">// aDriver should be created and opened for reading</div><div class="line">Handle(StdStorage_Data) aData;</div><div class="line"></div><div class="line">// Read data from the driver</div><div class="line">// StdStorage::Read creates aData instance automatically if it is null</div><div class="line">Storage_Error anError = StdStorage::Read(*aDriver, aData);</div><div class="line">if (anError != Storage_VSOk)</div><div class="line">{</div><div class="line">  // Error processing</div><div class="line">}</div><div class="line"></div><div class="line">// Get root objects</div><div class="line">Handle(StdStorage_RootData) aRootData = aData-&gt;RootData();</div><div class="line">Handle(StdStorage_HSequenceOfRoots) aRoots = aRootData-&gt;Roots();</div><div class="line">if (!aRoots.IsNull())</div><div class="line">{</div><div class="line">  // Iterator over the sequence of root objects</div><div class="line">  for (StdStorage_HSequenceOfRoots::Iterator anIt(*aRoots); anIt.More(); anIt.Next())</div><div class="line">  {</div><div class="line">    Handle(StdStorage_Root)&amp; aRoot = anIt.ChangeValue();</div><div class="line">    // Get a persistent root&#39;s object</div><div class="line">    Handle(StdObjMgt_Persistent) aPObject = aRoot-&gt;Object();</div><div class="line">    if (!aPObject.IsNull())</div><div class="line">    {</div><div class="line">      Handle(ShapePersistent_TopoDS::HShape) aHShape = Handle(ShapePersistent_TopoDS::HShape)::DownCast(aPObject);</div><div class="line">      if (aHShape) // Downcast to an expected type to import transient data</div><div class="line">      {</div><div class="line">        TopoDS_Shape aShape = aHShape-&gt;Import();</div><div class="line">        shapes.Append(aShape);</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>The following code demonstrates how to write shapes in OCCT 7.2.0 using <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_std_storage.html">StdStorage</a></em> class.</p>
<div class="fragment"><div class="line">// Create a file driver</div><div class="line">NCollection_Handle&lt;Storage_BaseDriver&gt; aFileDriver(new FSD_File());</div><div class="line"></div><div class="line">// Try to open the file driver for writing</div><div class="line">try</div><div class="line">{</div><div class="line">  OCC_CATCH_SIGNALS</div><div class="line">  PCDM_ReadWriter::Open (*aFileDriver, TCollection_ExtendedString(theFilename), Storage_VSWrite);</div><div class="line">}</div><div class="line">catch (Standard_Failure&amp; e)</div><div class="line">{</div><div class="line">  // Error processing</div><div class="line">}</div><div class="line"></div><div class="line">// Create a storage data instance</div><div class="line">Handle(StdStorage_Data) aData = new StdStorage_Data();</div><div class="line">// Set an axiliary application name (optional)</div><div class="line">aData-&gt;HeaderData()-&gt;SetApplicationName(TCollection_ExtendedString(&quot;Application&quot;));</div><div class="line"></div><div class="line">// Provide a map to track sharing</div><div class="line">StdObjMgt_TransientPersistentMap aMap;</div><div class="line">// Iterator over a collection of shapes</div><div class="line">for (Standard_Integer i = 1; i &lt;= shapes.Length(); ++i)</div><div class="line">{</div><div class="line">  TopoDS_Shape aShape = shapes.Value(i);</div><div class="line">  // Translate a shape to a persistent object</div><div class="line">  Handle(ShapePersistent_TopoDS::HShape) aPShape =</div><div class="line">    ShapePersistent_TopoDS::Translate(aShape, aMap, ShapePersistent_WithTriangle);</div><div class="line">  if (aPShape.IsNull())</div><div class="line">  {</div><div class="line">    // Error processing</div><div class="line">  }</div><div class="line"></div><div class="line">  // Construct a root name</div><div class="line">  TCollection_AsciiString aName = TCollection_AsciiString(&quot;Shape_&quot;) + i;</div><div class="line"></div><div class="line">  // Add a root to storage data</div><div class="line">  Handle(StdStorage_Root) aRoot = new StdStorage_Root(aName, aPShape);</div><div class="line">  aData-&gt;RootData()-&gt;AddRoot(aRoot);</div><div class="line">}</div><div class="line"></div><div class="line">// Write storage data to the driver</div><div class="line">Storage_Error anError = StdStorage::Write(*aFileDriver, aData);</div><div class="line">if (anError != Storage_VSOk)</div><div class="line">{</div><div class="line">  // Error processing</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="upgrade_720_Change_In_BRepLib_MakeFace_Algo"></a>
Change in BRepLib_MakeFace algorithm</h2>
<p>Previously, <em><a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_b_rep_lib___make_face.html">BRepLib_MakeFace</a></em> algorithm changed orientation of the source wire in order to avoid creation of face as a hole (i.e. it is impossible to create the entire face as a hole; the hole can be created in context of another face only). New algorithm does not reverse the wire if it is open. Material of the face for the open wire will be located on the left side from the source wire.</p>
<h2><a class="anchor" id="upgrade_720_Change_In_BRepFill_OffsetWire"></a>
Change in BRepFill_OffsetWire algorithm</h2>
<p>From now on, the offset will always be directed to the outer region in case of positive offset value and to the inner region in case of negative offset value. Inner/Outer region for an open wire is defined by the following rule: when we go along the wire (taking into account edges orientation) the outer region will be on the right side, the inner region will be on the left side. In case of a closed wire, the inner region will always be inside the wire (at that, the edges orientation is not taken into account).</p>
<h2><a class="anchor" id="upgrade_720_Change_In_GeomAdaptor_Curve"></a>
Change in Geom(2d)Adaptor_Curve::IsPeriodic</h2>
<p>Since 7.2.0 version, method <em>IsPeriodic()</em> returns the corresponding status of periodicity of the basis curve regardless of closure status of the adaptor curve (see method <em>IsClosed()</em>). Method <em>IsClosed()</em> for adaptor can return false even on periodic curve, in the case if its parametric range is not full period, e.g. for adaptor on circle in range [0, \( \pi \)]. In previous versions, <em>IsPeriodic()</em> always returned false if <em>IsClosed()</em> returned false.</p>
<h2><a class="anchor" id="upgrade_720_UnifySameDomain"></a>
Change in algorithm ShapeUpgrade_UnifySameDomain</h2>
<p>The history of the changing of the initial shape was corrected:</p><ul>
<li>all shapes created by the algorithm are considered as modified shapes instead of generated ones;</li>
<li>method Generated was removed and its calls should be replaced by calls of method History()-&gt;Modified.</li>
</ul>
<h2><a class="anchor" id="upgrade_720_Change_In_RWStl"></a>
Changes in STL Reader / Writer</h2>
<p>Class <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_r_w_stl.html">RWStl</a> now uses class <a class="elRef" doxygen="C:/builds/IR-2017-08-29_IR-2017-08-29/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_poly___triangulation.html">Poly_Triangulation</a> for storing triangular mesh instead of StlMesh data classes; the latter have been removed.</p>
<h2><a class="anchor" id="upgrade_720_New_Error_Warning_system_in_BOA"></a>
Refactoring of the Error/Warning reporting system in Boolean Component</h2>
<p>The Error/Warning reporting system of the algorithms in Boolean Component (in all BOPAlgo_* and BRepAlgoAPI_* algorithms) has been refactored. The methods returning the status of errors and warnings of the algorithms (ErrorStatus() and WarningStatus()) have been removed. Instead use methods HasErrors() and HasWarnings() to check for presence of errors and warnings, respectively. The full list of errors and warnings, with associated data such as problematic sub-shapes, can be obtained by method GetReport(). </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Aug 30 2017 17:08:51 for Open CASCADE Technology by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
